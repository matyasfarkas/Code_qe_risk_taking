%% This file writes the mod files with the given parameters

%% Opening the non binding model file
 fid = fopen(['FMcc.mod'],'w+');
%% Writing the mod file for simulation
    
                fprintf(fid,'// A Dynare version of Counter cyclical Monetary policy at the ZLB based on \n');
                fprintf(fid,'// Meh and Moran. 2010. "The Role of Bank Capital in the Propagation of Shocks"\n');
                fprintf(fid,'// JEDC 34: 555-576\n');
                fprintf(fid,'// Written by Matyas Farkas, 2019\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 1. Variable declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'var \n');
                fprintf(fid,'ch    % 1- household consumption\n');
                fprintf(fid,'Ce    % 2- entrepreneurial consumption\n');
                fprintf(fid,'Cb    % 3- banking consumption\n');
                fprintf(fid,'H     % 4- aggregate (composite) labour input\n');
                fprintf(fid,'Y     % 5- Output\n');
                fprintf(fid,'I     % 6- Investment \n');
                fprintf(fid,'bigN  % 7- entrepreneurial net worth \n');
                fprintf(fid,'bigA  % 8- net worth of banking sector (bank capital)\n');
                fprintf(fid,'smallb % 9 - private benefit\n');
                fprintf(fid,'q     % 10- relative price of capital goods\n');
                fprintf(fid,'rk    % 11- rental rate on capital\n');
                fprintf(fid,'infl  % 12 - gross rate of quarterly inflation\n');
                fprintf(fid,'w_h   % 13 - wage rate (households)\n');
                fprintf(fid,'w_e   % 14 - wage rate (entrepreneurs)\n');
                fprintf(fid,'w_b   % 15 - wage rate (bankers)\n');
                fprintf(fid,'Rd    % 16 - gross, nominal rate of interest\n');
                fprintf(fid,'Ra    % 17 - gross return on bank capital\n');
                fprintf(fid,'lam   % 18 - marginal utility of consumption\n');
                fprintf(fid,'mu     % 19 - endogenous monitoring intensity\n');
                fprintf(fid,'p     % 20 - inverse of real money balances\n');
                fprintf(fid,'TL    % 21 -Aggregate bank lending in the economy\n');
                fprintf(fid,'mc    % 22 - fraction of HH''s financiel assets held as currency\n');
                fprintf(fid,'s     % 23 -marginal costs\n');
                fprintf(fid,'mgrowth % 24- growth rate of money\n');
                fprintf(fid,'expinfl % 25 - expected rate of inflation at time t+1\n');
                fprintf(fid,'smalld  % 26 - real value of household deposits  \n');
                fprintf(fid,'gY   % 27- gross rate of output growth\n');
                fprintf(fid,'totC % 28 - aggregate consumption\n');
                fprintf(fid,'u    % 29 - utilization rate on physical capital \n');
                fprintf(fid,'keff  % 30 - effective capital services\n');
                fprintf(fid,'K     % 31 - total physical capital\n');
                fprintf(fid,'Kb    % 32 - holdings of physical capital by banking sector\n');
                fprintf(fid,'Ke    % 33 - holdings of physical capital by entrepreneurial sector\n');
                fprintf(fid,'ptilde % 34 - price chosen by reoptimising price-setters\n');
                fprintf(fid,'nump   % 35 - auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'denp   % 36 -auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'wtilde % 37 -price chosen by reoptimising wage-setters\n');
                fprintf(fid,'numw   % 38 - auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'denw   % 39 -auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'lz     % 40 - log of exogenous technology z\n');
                fprintf(fid,'lmp    % 41- log of monetary policy disturbance\n');
                fprintf(fid,'lbk    % 42 - log of disturbances to bank capital\n');
                fprintf(fid,'log_y  % 43 - auxiliary variable for log output\n');
                fprintf(fid,'log_I  % 44 -  auxiliary variable for log of investment\n');
                fprintf(fid,'gammag % 45 - leverage ratio set by the supervisory authority \n');
                fprintf(fid,'alpha  % 46 - endogenous probability of default\n');
                fprintf(fid,'rnot   % 47 - shadow policy rate\n');
                fprintf(fid,'CBBS % 48 - QE in percentag of output\n');
                fprintf(fid,'lqe  % 49 - log of QE disturbance\n');
                fprintf(fid,'inflexp1  % 50 - 10Year inflation expectations\n');
                
                fprintf(fid,'inflexp2  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  % 50 - 10Year inflation expectations\n');

                fprintf(fid,'Rexp1  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp2  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp3  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp4  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp5  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp6  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp7  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp8  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp9  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp10  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp11  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp12  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp13  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp14  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp15  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp16  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp17  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp18  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp19  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp20  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp21  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp22  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp23  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp24  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp25  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp26  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp27  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp28  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp29  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp30  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp31  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp32  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp33  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp34  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp35  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp36  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp37  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp38  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp39  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp40  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'BVaR  % Bank VaR driven default probability\n');

                
                fprintf(fid,';\n');
                fprintf(fid,'varexo \n');
                fprintf(fid,'z_shk  % innovation to productivity process\n');
                fprintf(fid,'mp_shk % innovation to monetary policy process\n');
                fprintf(fid,'bk_shk % innovation to the bank capital shock\n');
                fprintf(fid,'qe_shk % innovation to QE\n');
                fprintf(fid,';\n');
%% Parameter definition 
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 2. Parameter declaration and calibration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'parameters \n');
                fprintf(fid,'habit  % Parameter of habit formation\n');
                fprintf(fid,'bet      % Discount factor\n');
                fprintf(fid,'delta   % Depreciation of physical capital\n');
                fprintf(fid,'reta     % Parameter of leisure in utility\n');
                fprintf(fid,'psi_l  % Parameter related to labour supply (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) \n');
                fprintf(fid,'elas_l % Elasticity of labour utility psi_l = 4.55 and elas_l=0.429  \n');
                fprintf(fid,'chi1 % Parameter governing capital utilization following Fernandez Villaverde et al. (2010) upsilon(u) = chi_1(u-1)+ 0.5*chi_2(u-1)^2\n');
                fprintf(fid,'chi2  % Parameter in capital utilization\n');
                fprintf(fid,'pi_ss % Steady state level of inflation\n');
                fprintf(fid,'xi_w %Parameter governing nominal rigidities and elasticities of substitution following CEE, 2005 xi_w = 21\n');
                fprintf(fid,'phi_w % Parameter governing nominal rigidities of wage setting\n');
                fprintf(fid,'mark_w % Parameter of wage markup\n');
                fprintf(fid,'eta_h % Measure of agents that are households\n');
                fprintf(fid,'eta_e % Measure of agents that are entrepreneurs\n');
                fprintf(fid,'eta_b % Measure of agents that are bankers\n');
                fprintf(fid,'xi_p % Parameter governing nominal rigidities of the intermediate producers\n');
                fprintf(fid,'phi_p % Parameter of price updating probability of intermediate producers\n');
                fprintf(fid,'mark_p % Price markup on the intermediate producers side\n');
                fprintf(fid,'theta_k % Share of capital in production\n');
                fprintf(fid,'theta_h % Share of household labor in production\n');
                fprintf(fid,'theta_e % Share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b % Share of bank labor in production\n');
                fprintf(fid,'bigR % Overall return to the investment project \n');
                fprintf(fid,'delalpha % Difference in probability of success between high and low effort\n');
                fprintf(fid,'tau_b % Survival probability of banker\n');
                fprintf(fid,'tau_e % Survival probability of entrepreneurs\n');
                fprintf(fid,'lam_r  % AR(1) parameter in the Taylor rule, for short term interest rate smoothing\n');
                fprintf(fid,'lam_pi % Parameter on the inflation target in the Taylor rule\n');
                fprintf(fid,'lam_y % Parameter of output stabilization in the Taylor rule\n');
                fprintf(fid,'bigtheta % Overall Profits\n');
                fprintf(fid,'bby % Additional capital endowment banks receive every period, as a percentage of output, set 0 by default, increased to 0.007 for the experiment Economy with More Bank Capital\n');
                fprintf(fid,'nu % Valuation mulitplier for exiting bankers consumption\n');
                fprintf(fid,'rhoz % AR(1) coefficient for the technology shock\n');
                fprintf(fid,'rhomp % AR(1) coefficient for the monetary policy\n');
                fprintf(fid,'rhobk % AR(1) coefficient of the bank capital shock\n');
                fprintf(fid,'sigmaz % Standard deviation of the technology shock\n');
                fprintf(fid,'sigmamp % Standard deviation of the monetary policy shock\n');
                fprintf(fid,'sigmabk  % Standard deviation of the bank capital shock\n');
                fprintf(fid,'alpha_ss % Steady state probability of success given high effort that is also the bank success probability\n');
                fprintf(fid,'mu_ss % Steady state of monitoring effort by banks\n');
                fprintf(fid,'% gammag_ss % Steady state level of bank leverage \n');
                fprintf(fid,'omega % Parameter linking endogenous probability of success to credit to GDP ratio\n');
                fprintf(fid,'varsigma % Parameter linking endogenous riskiness of the banking sector to total lending\n');
                fprintf(fid,'epsb % Parameter linking probability of success to monitoring\n');
                fprintf(fid,'Btopbar % Maximum level of private benefit\n');
                fprintf(fid,'Blowbar % Lower level of private benefit\n');
                fprintf(fid,'Chi % Parameter for endogenous private benefit\n');
                fprintf(fid,'CBBSp % Parameter governing the QE/Central bank balance sheet reaction\n');
                fprintf(fid,'sigmaqe % Standard deviation of QE shock\n');
                fprintf(fid,'rhoqe % AR(1) coefficient of the QE shock process\n');
                fprintf(fid,';\n');
                
%% Calibration
                fprintf(fid,'sigmaqe = %15.14f; \n',sigmaqe);
                fprintf(fid,'rhoqe = %5.4f; \n',rhoqe);
                fprintf(fid,'habit = %5.4f;  %parameter governing habit formation (CEE 2005 use 0.65)\n', habit);
                fprintf(fid,'bet = %5.4f;    %discount factor\n', bet);
                fprintf(fid,'delta = %5.4f;  %depreciation of physical capital\n', delta);
                fprintf(fid,'reta = %15.14f;\n',reta);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% parameters related to labour supply\n');
                fprintf(fid,'% (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) )\n');
                fprintf(fid,'% elas_l = 1 follows CEE(2005)\n');
                fprintf(fid,'% elas_l = 0.429 reproduces (for dynamics) our JEDC specification with log disutility\n');
                fprintf(fid,'% in either case, psi_l is set in order for work effort at ss to be 0.3\n');
                fprintf(fid,'% (this requires psi_l = 4.55 if elas_l = 0.429)\n');
                fprintf(fid,'%psi_l = 9.05;\n');
                fprintf(fid,'%elas_l = 1.0;\n');
                fprintf(fid,'psi_l = %5.4f;\n', psi_l);
                fprintf(fid,'elas_l = %5.4f;\n', elas_l);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'%parameters of monetary policy\n');
                fprintf(fid,'pi_ss = %8.7f;\n', pi_ss);
                fprintf(fid,'lam_r = %5.4f;\n', lam_r);
                fprintf(fid,'lam_pi = %5.4f;\n', lam_pi);
                fprintf(fid,'lam_y = %5.4f;\n', lam_y);
                fprintf(fid,'%lam_y = 0.1;\n');
                fprintf(fid,'Rd_temp = pi_ss/bet;\n');
                fprintf(fid,'% nominal rigidities and elasticities of substitution\n');
                fprintf(fid,'% (follows CEE, 2005)\n');
                fprintf(fid,'xi_w = %3.1f;\n', xi_w);
                fprintf(fid,'phi_w = %5.4f;\n', phi_w);
                fprintf(fid,'xi_p = %5.4f;\n',xi_p);
                fprintf(fid,'phi_p = %5.4f;\n',phi_p);
                fprintf(fid,'mark_p  = xi_p/(xi_p-1);\n');
                fprintf(fid,'mark_w = xi_w/(xi_w-1);\n');
                fprintf(fid,'eta_h = %5.4f;            % measure of agents that are households\n', eta_h);
                fprintf(fid,'eta_e = %5.4f;           % measure of agents that are entrepreneurs\n', eta_e);
                fprintf(fid,'eta_b = 1-eta_h-eta_e;    % measure of agents that are bankers\n');
                fprintf(fid,'theta_h = %15.14f;   % share of household labor in production\n', theta_h);
                fprintf(fid,'theta_k = %15.14f;       % share of capital in production\n', theta_k);
                fprintf(fid,'theta_e = (1.0-theta_h-theta_k)/2.0;    % share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b = 1.0-theta_h-theta_k-theta_e;   % share of bank labor in production\n');
                fprintf(fid,'% sector producing physical capital\n');
                fprintf(fid,'delalpha = %15.14f;\n',delalpha);
                fprintf(fid,'tau_b = %15.14f; \n',tau_b);
                fprintf(fid,'tau_e = %15.14f;\n', tau_e);
                fprintf(fid,'bigR = %15.14f; \n', bigR);
                fprintf(fid,'% In some experiments, we want to leave mu_ss unchanged at 0.025 (to compute s.s.)\n');
                fprintf(fid,'% but have mu = 0.0 for the linearization (to produce "WITH BANK CAPITAl CHANNEL" responses\n');
                fprintf(fid,'% and "NO BANK CAPITAl CHANNEL" responses)\n');
                fprintf(fid,'% in order to do that, need to disable lines 81-84 in the "steady_.m" program\n');
                fprintf(fid,'% of your dynare build\n');
                fprintf(fid,'bby = %5.4f;\n', bby);
                fprintf(fid,'               % additional capital endowment banks receive every period, as a percentage of output.\n');
                fprintf(fid,'               % (This is used for the experiments titled\n');
                fprintf(fid,'               % "Economy with More Bank Capital"): for that, set bby to  0.007\n');
                fprintf(fid,'nu = %15.14f;\n',nu);
                fprintf(fid,'% Parameters related to shock processes\n');
                fprintf(fid,'rhoz = %15.14f;    %autocorrelation of technology\n',rhoz);
                fprintf(fid,'sigmaz = %15.14f; % s.d. of innovation to technology\n',sigmaz);
                fprintf(fid,'%sigmaz = 0.0015;\n');
                fprintf(fid,'%Parameter related to capital utilisation:\n');
                fprintf(fid,'sigma_a = %15.14f;\n',sigma_a);
                fprintf(fid,'rhomp = %15.14f;  %autocorrelation of disturbances to the MP rule\n',rhomp);
                fprintf(fid,'sigmamp = %15.14f; % s.d. of innovations to these disturbances.\n',sigmamp);
                fprintf(fid,'rhobk = %15.14f;  %autocorrelation of shocks to bank capital\n',rhobk);
                fprintf(fid,'sigmabk = %15.14f; % s.d. of innovations to these disturbances.\n',rhobk);
                fprintf(fid,'%sigmabk = 0.000001;\n');
                fprintf(fid,'alpha_ss = %15.14f;\n',alpha_ss);
                fprintf(fid,'Chi =  %15.13f;            % 3.0792;       %sensitivity of entrepreneurial private benefit to monitoring intensity\n',Chi);
                fprintf(fid,'epsb = %15.13f;      %linkage between shirking and premium paid\n', epsb);
                fprintf(fid,'Btopbar =  %15.13f; %maximum private benefits from shirking;\n', Btopbar);
                fprintf(fid,'Blowbar = %5.4f; \n',Blowbar);
                fprintf(fid,'omega = %15.14f;     % Strength of response of monetary authority to deviations from credittogdp \n', omega);
                fprintf(fid,'varsigma = %15.14f;  % Strength of the endogenous link between credit to GDP devation from SS to banking sector riskiness\n', varsigma);
                fprintf(fid,'mu_ss = %15.14f;\n',mu_ss);
                fprintf(fid,'CBBSp = %15.14f;\n',CBBSp);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');               
%% Steady state computations
                fprintf(fid,'% steady-state computations:\n');
                fprintf(fid,'\n');
                fprintf(fid,'alphatemp = alpha_ss;\n');
                fprintf(fid,'mutemp = mu_ss;\n');
                fprintf(fid,'smallbtemp = Btopbar*(1+Chi*mutemp)^(-epsb);\n');
                fprintf(fid,'kk1 = delta*theta_k/(alphatemp*bigR*(1/bet-1+delta)); \n');
                fprintf(fid,'betatemp  = 1/bet;\n');
                fprintf(fid,'infl_temp = pi_ss;\n');
                fprintf(fid,'qtemp = kk1*(alphatemp*tau_b*mutemp*betatemp/delalpha-(1+mutemp+alphatemp*mutemp/(Rd_temp*delalpha)));\n');
                fprintf(fid,'qtemp = qtemp/(alphatemp*smallbtemp*kk1/(Rd_temp*delalpha)-alphatemp*bigR*kk1/Rd_temp-theta_e-theta_b-bby-alphatemp*tau_e*smallbtemp*kk1*betatemp/delalpha);\n');
                fprintf(fid,'Gtemp = 1+mutemp-(qtemp*alphatemp/Rd_temp)*(bigR-mutemp/(qtemp*delalpha)-smallbtemp/delalpha);\n');
                fprintf(fid,'IY = kk1/qtemp;\n');
                fprintf(fid,'KY = alphatemp*bigR*IY/delta; \n');
                fprintf(fid,'KeY = tau_e*alphatemp*smallbtemp*IY/delalpha;\n');
                fprintf(fid,'KbY = tau_b*alphatemp*mutemp*IY/(qtemp*delalpha);\n');
                fprintf(fid,'KhY = KY - KeY - KbY;\n');
                fprintf(fid,'CeY = (1-tau_e)*alphatemp*smallbtemp*IY*qtemp/delalpha;\n');
                fprintf(fid,'CbY = nu*(1-tau_b)*alphatemp*mutemp*IY/delalpha;\n');
                fprintf(fid,'ChY = 1 + bby - CeY - CbY  - (1+mutemp)*IY;\n');
                fprintf(fid,'essai = (1-bet*habit)*theta_h/((1-habit)*ChY*psi_l*mark_w);\n');
                fprintf(fid,'smallh = essai^(1/(1+elas_l));\n');
                fprintf(fid,'Htemp = smallh*eta_h^(xi_w/(xi_w-1));\n');
                fprintf(fid,'kk2 = (KY^(1/(1-theta_k))) * (eta_e^(theta_e/(1-theta_k)))* (eta_b^(theta_b/(1-theta_k)))* mark_p^(1/(theta_k-1));\n');
                fprintf(fid,'Ktemp = Htemp^(theta_h/(1-theta_k))* kk2;\n');
                fprintf(fid,'Ytemp = (1/mark_p)* (Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'% fixed cost parameter to ensure zero profits in s.s.\n');
                fprintf(fid,'bigtheta = (mark_p-1)*Ytemp;\n');
                fprintf(fid,'Itemp = IY*Ytemp;\n');
                fprintf(fid,'rktemp = (1/mark_p)*theta_k*(Ktemp^(theta_k-1))*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% Following Fernandez Villaverde et al. (2010) as well as others,\n');
                fprintf(fid,'% set utilisation of capital as \n');
                fprintf(fid,'%upsilon(u) = chi_1 (u - 1) + 0.5chi_2 (u - 1)^2\n');
                fprintf(fid,'%Set parameters in a way that replicates CEE (2005)\n');
                fprintf(fid,'\n');
                fprintf(fid,'chi1 = rktemp;\n');
                fprintf(fid,'chi2 = sigma_a*chi1;  \n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'w_htemp = (1/mark_p)*theta_h*(Ktemp^theta_k)*(Htemp^(theta_h-1))*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'w_etemp = (1/mark_p)*theta_e*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^(theta_e-1))*(eta_b^theta_b);\n');
                fprintf(fid,'w_btemp = (1/mark_p)*theta_b*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^(theta_b-1));\n');
                fprintf(fid,'Ketemp = KeY*Ytemp;\n');
                fprintf(fid,'Kbtemp = KbY*Ytemp;\n');
                fprintf(fid,'Khtemp = KhY*Ytemp;\n');
                fprintf(fid,'Cetemp = CeY*Ytemp;\n');
                fprintf(fid,'Cbtemp = CbY*Ytemp;\n');
                fprintf(fid,'chtemp = ChY*Ytemp/eta_h;\n');
                fprintf(fid,'bigAtemp = eta_b*w_btemp+(rktemp+qtemp*(1-delta))*Kbtemp+bby*Ytemp;\n');
                fprintf(fid,'bigNtemp = eta_e*w_etemp+(rktemp+qtemp*(1-delta))*Ketemp;\n');
                fprintf(fid,'totCtemp = Cetemp+Cbtemp+eta_h*chtemp;\n');
                fprintf(fid,'lamtemp = (1-bet*habit)/((1-habit)*(chtemp));\n');
                fprintf(fid,'smalldtemp = alphatemp*qtemp*( bigR - smallbtemp/delalpha - mutemp/(qtemp*delalpha))*Itemp/(Rd_temp*eta_b);\n');
                fprintf(fid,'ptemp = (Rd_temp-1)*lamtemp/ ( (Rd_temp-1)*lamtemp*eta_b*smalldtemp + eta_h*reta);\n');
                fprintf(fid,'mctemp = reta*ptemp/((Rd_temp-1)*lamtemp);\n');
                fprintf(fid,'Ratemp = alphatemp*qtemp*(mutemp/(qtemp*delalpha))*Itemp/bigAtemp;\n');
                fprintf(fid,'TLtemp = Itemp-bigNtemp;\n');
                fprintf(fid,'wtildetemp = w_htemp*infl_temp*eta_h^(-1/(1-xi_w));\n');
                fprintf(fid,'numwtemp =  ( ( (w_htemp*infl_temp)^(xi_w*(1+elas_l)) * Htemp^(1+elas_l) )/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denwtemp = ( (w_htemp^(xi_w)*infl_temp^(xi_w-1)*Htemp*lamtemp)/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'wtildetemp = (mark_w*psi_l)^(1/(1+xi_w*elas_l))*numwtemp/denwtemp;\n');
                fprintf(fid,'stemp = 1/mark_p;\n');
                fprintf(fid,'mgrowthtemp = infl_temp;\n');
                fprintf(fid,'expinfltemp = infl_temp;\n');
                fprintf(fid,'gYtemp = 1;\n');
                fprintf(fid,'utemp = 1;\n');
                fprintf(fid,'gammagtemp = (Itemp-bigNtemp )/bigAtemp;\n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 3. Model declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'model;  \n');
                fprintf(fid,'1/(ch - habit*ch(-1)) - bet*habit*1/(ch(+1) - habit*ch) = lam;\n');
                fprintf(fid,'reta/(mc/p) = (Rd-1)*lam;\n');
                fprintf(fid,'rk = chi1 + chi2*(u - 1);\n');
                fprintf(fid,'q*lam = bet* (lam(+1)* ( q(+1)*(1-delta) + rk(+1)*u- ( chi1*(u-1)+0.5*chi2*(u(+1)-1)^2 ) ));\n');
                fprintf(fid,'lam = bet*lam(+1)*Rd(+1)/infl(+1);\n');
                fprintf(fid,'infl = p*mgrowth/p(-1);\n');
                fprintf(fid,'wtilde = (xi_w *psi_l/(xi_w-1))^(1/(1+elas_l*xi_w)) * numw /  denw;\n');
                fprintf(fid,'numw =  ( bet*phi_w*(numw(+1)^(1+elas_l*xi_w)) + (H^(1+elas_l)) *(w_h*infl)^(xi_w*(1+elas_l)) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denw =  ( bet*phi_w*(denw(+1)^(1+elas_l*xi_w)) + lam*H*(w_h^xi_w)*(infl^(xi_w-1)) )^(1/(1+elas_l*xi_w)) ;\n');
                fprintf(fid,'infl^(1-xi_w) *w_h^(1-xi_w) = eta_h*(1-phi_w)*wtilde^(1-xi_w) + phi_w* infl(-1)^(1-xi_w) *w_h(-1)^(1-xi_w);\n');
                fprintf(fid,'ptilde = xi_p * nump/ ((xi_p - 1) * denp );\n');
                fprintf(fid,'nump = bet*phi_p*nump(+1) + lam*s*Y*infl^xi_p;\n');
                fprintf(fid,'denp = bet*phi_p*denp(+1) + lam*Y*infl^(xi_p-1);\n');
                fprintf(fid,'infl^(1-xi_p) = (1-phi_p)*ptilde^(1-xi_p) + phi_p*infl(-1)^(1-xi_p);\n');
                fprintf(fid,'rk = s * exp(lz)* theta_k * keff^(theta_k-1) * H^theta_h * eta_e^theta_e *eta_b^(theta_b);\n');
                fprintf(fid,'w_h = s * exp(lz)* theta_h * keff^(theta_k) * H^(theta_h-1) * eta_e^theta_e * eta_b^(theta_b);\n');
                fprintf(fid,'w_e = s * exp(lz)* theta_e * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e-1) * eta_b^(theta_b);\n');
                fprintf(fid,'w_b = s * exp(lz)* theta_b * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e) * eta_b^(theta_b-1);\n');
                fprintf(fid,'%I = (bigA+bigN)/G;\n');
                fprintf(fid,'bigA*Ra = alpha * mu*I/delalpha;\n');
                fprintf(fid,'%G = 1+ mu - q *alpha*( bigR - smallb/delalpha - mu/(q*delalpha) )/(Rd);\n');
                fprintf(fid,'Rd*(1-eta_h*mc)/p = q*alpha*( bigR-smallb/delalpha - mu/(q*delalpha))*I;\n');
                fprintf(fid,'Kb = tau_b*alpha*mu*I/(q*delalpha);\n');
                fprintf(fid,'Ke = tau_e*alpha*smallb*I/delalpha;\n');
                fprintf(fid,'bigA = exp(lbk)*( rk + q*(1-delta))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'%bigA = exp(lbk)*( rk + q*(1-delta*exp(lbk)))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'bigN = ( rk + q*(1-delta))*Ke(-1) + eta_e*w_e;\n');
                fprintf(fid,'Cb = (1-tau_b)*alpha*mu*I/delalpha;\n');
                fprintf(fid,'Ce = (1-tau_e)*alpha*q*smallb*I/delalpha;\n');
                fprintf(fid,'eta_h *ch + Ce + Cb + I + I*mu = Y;\n');
                fprintf(fid,'K = (1-delta)*K(-1) + alpha*bigR*I;\n');
                fprintf(fid,'log(rnot/steady_state(rnot)) = lam_r*log( rnot(-1)/steady_state(rnot) ) + (1-lam_r) * ( lam_pi*log(infl/steady_state(infl)) + lam_y*log(Y/steady_state(Y)) ) + lmp;\n');
                fprintf(fid,'Rd = rnot;\n');
                fprintf(fid,'Y = exp(lz)* (keff^theta_k)*(H^theta_h)*(eta_e^theta_e)*(eta_b^theta_b) - bigtheta;\n');
                fprintf(fid,'%CA = bigA/((1+mu)*I-bigN);\n');
                fprintf(fid,'eta_b* smalld = (1-eta_h*mc)/p;\n');
                fprintf(fid,'keff = u*( K(-1) - Ke(-1) - Kb(-1) ) + Ke(-1) + Kb(-1);\n');
                fprintf(fid,'expinfl = infl(+1);\n');
                fprintf(fid,'gY = Y/Y(-1);\n');
                fprintf(fid,'TL = I - bigN;\n');
                fprintf(fid,'totC = eta_h *ch + Ce + Cb;\n');
                fprintf(fid,'lz = rhoz*lz(-1)+ z_shk;\n');
                fprintf(fid,'lmp = rhomp*lmp(-1)+ mp_shk;\n');
                fprintf(fid,'lbk = rhobk*lbk(-1)- bk_shk;\n');
                fprintf(fid,'log_y = log(Y);\n');
                fprintf(fid,'log_I = log(I);\n');
                fprintf(fid,'smallb = Btopbar *(1+Chi*mu)^(-epsb);\n');
                fprintf(fid,'alpha = 1 - (1-alpha_ss) - ((I-bigN)/Y-(steady_state(I)-steady_state(bigN))/steady_state(Y))*varsigma ; %Endogenous riskiness of the banking sector\n');
                fprintf(fid,'gammag = steady_state(gammag) + omega*(BVaR-steady_state(BVaR)); % Regulatory authority rule\n');
                fprintf(fid,'I =gammag * bigA + bigN + CBBS*Y;  % Equtaion 43 on page 21\n');
                fprintf(fid,'gammag = 1 + (q*Ra/Rd)*(delalpha*bigR-smallb-mu/q)/mu - Ra*delalpha/alpha; % Equation 15 on page 9 in CMM(2011)\n');
                fprintf(fid,'CBBS = lqe/steady_state(Y);\n');
                fprintf(fid,'lqe = rhoqe*lqe(-1)+ qe_shk;\n');
                fprintf(fid,'inflexp1  = infl(+1); % 50 - 10Year inflation expectations\n');

                fprintf(fid,'inflexp2  = inflexp1(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  = inflexp2(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  = inflexp3(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  = inflexp4(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  = inflexp5(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  = inflexp6(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  = inflexp7(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  = inflexp8(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  = inflexp9(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  = inflexp10(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  = inflexp11(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  = inflexp12(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  = inflexp13(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  = inflexp14(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  = inflexp15(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  = inflexp16(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  = inflexp17(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  = inflexp18(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  = inflexp19(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  = inflexp20(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  = inflexp21(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  = inflexp22(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  = inflexp23(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  = inflexp24(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  = inflexp25(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  = inflexp26(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  = inflexp27(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  = inflexp28(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  = inflexp29(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  = inflexp30(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  = inflexp31(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  = inflexp32(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  = inflexp33(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  = inflexp34(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  = inflexp35(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  = inflexp36(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  = inflexp37(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  = inflexp38(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  = inflexp39(+1); % 50 - 10Year inflation expectations\n');

                 fprintf(fid,'Rexp1  = Rd(+1); % 50 - 10Year Yields expectations\n');    
                fprintf(fid,'Rexp2  = Rexp1(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp3  = Rexp2(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp4  = Rexp3(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp5  = Rexp4(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp6  = Rexp5(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp7  = Rexp6(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp8  = Rexp7(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp9  = Rexp8(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp10  = Rexp9(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp11  = Rexp10(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp12  = Rexp11(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp13  = Rexp12(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp14  = Rexp13(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp15  = Rexp14(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp16  = Rexp15(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp17  = Rexp16(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp18  = Rexp17(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp19  = Rexp18(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp20  = Rexp19(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp21  = Rexp20(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp22  = Rexp21(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp23  = Rexp22(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp24  = Rexp23(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp25  = Rexp24(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp26  = Rexp25(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp27  = Rexp26(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp28  = Rexp27(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp29  = Rexp28(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp30  = Rexp29(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp31  = Rexp30(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp32  = Rexp31(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp33  = Rexp32(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp34  = Rexp33(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp35  = Rexp34(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp36  = Rexp35(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp37  = Rexp36(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp38  = Rexp37(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp39  = Rexp38(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp40  = Rexp39(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'BVaR = mu/(q*(exp(0.25)-1)); \n');

                fprintf(fid,'end;\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 4. Initial values and steady state\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'resid;\n');
                fprintf(fid,'steady;  \n');
                fprintf(fid,'check;                    \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 5. Shock declaration  \n');
                fprintf(fid,'//                       \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'shocks;\n');
                fprintf(fid,'var z_shk = sigmaz^2;\n');
                fprintf(fid,'var mp_shk = sigmamp^2;\n');
                fprintf(fid,'var bk_shk = sigmabk^2;\n');
                fprintf(fid,'var qe_shk = sigmaqe^2;\n');
                fprintf(fid,'end;\n');
                fprintf(fid,'stoch_simul(order=2,irf = 0,hp_filter = 1600)  Y I q gammag bigA TL bigN Rd infl mu alpha;\n');
                fprintf(fid,'options_.debug = 1;\n');
                fprintf(fid,'%options_.pruning=1;\n');
                fprintf(fid,'%stoch_simul(order=2,replic = 50,irf = 40,noprint,nograph,hp_filter = 1600);\n');
                
fclose('all');
%% Opening the model with ZLB and QE
 fid = fopen(['FMzlb.mod'],'w+');
%% Writing the mod file for simulation
    
                fprintf(fid,'// A Dynare version of Counter cyclical Monetary policy at the ZLB based on \n');
                fprintf(fid,'// Meh and Moran. 2010. "The Role of Bank Capital in the Propagation of Shocks"\n');
                fprintf(fid,'// JEDC 34: 555-576\n');
                fprintf(fid,'// Written by Matyas Farkas, 2019\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 1. Variable declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'var \n');
                fprintf(fid,'ch    % 1- household consumption\n');
                fprintf(fid,'Ce    % 2- entrepreneurial consumption\n');
                fprintf(fid,'Cb    % 3- banking consumption\n');
                fprintf(fid,'H     % 4- aggregate (composite) labour input\n');
                fprintf(fid,'Y     % 5- Output\n');
                fprintf(fid,'I     % 6- Investment \n');
                fprintf(fid,'bigN  % 7- entrepreneurial net worth \n');
                fprintf(fid,'bigA  % 8- net worth of banking sector (bank capital)\n');
                fprintf(fid,'smallb % 9 - private benefit\n');
                fprintf(fid,'q     % 10- relative price of capital goods\n');
                fprintf(fid,'rk    % 11- rental rate on capital\n');
                fprintf(fid,'infl  % 12 - gross rate of quarterly inflation\n');
                fprintf(fid,'w_h   % 13 - wage rate (households)\n');
                fprintf(fid,'w_e   % 14 - wage rate (entrepreneurs)\n');
                fprintf(fid,'w_b   % 15 - wage rate (bankers)\n');
                fprintf(fid,'Rd    % 16 - gross, nominal rate of interest\n');
                fprintf(fid,'Ra    % 17 - gross return on bank capital\n');
                fprintf(fid,'lam   % 18 - marginal utility of consumption\n');
                fprintf(fid,'mu     % 19 - endogenous monitoring intensity\n');
                fprintf(fid,'p     % 20 - inverse of real money balances\n');
                fprintf(fid,'TL    % 21 -Aggregate bank lending in the economy\n');
                fprintf(fid,'mc    % 22 - fraction of HH''s financiel assets held as currency\n');
                fprintf(fid,'s     % 23 -marginal costs\n');
                fprintf(fid,'mgrowth % 24- growth rate of money\n');
                fprintf(fid,'expinfl % 25 - expected rate of inflation at time t+1\n');
                fprintf(fid,'smalld  % 26 - real value of household deposits  \n');
                fprintf(fid,'gY   % 27- gross rate of output growth\n');
                fprintf(fid,'totC % 28 - aggregate consumption\n');
                fprintf(fid,'u    % 29 - utilization rate on physical capital \n');
                fprintf(fid,'keff  % 30 - effective capital services\n');
                fprintf(fid,'K     % 31 - total physical capital\n');
                fprintf(fid,'Kb    % 32 - holdings of physical capital by banking sector\n');
                fprintf(fid,'Ke    % 33 - holdings of physical capital by entrepreneurial sector\n');
                fprintf(fid,'ptilde % 34 - price chosen by reoptimising price-setters\n');
                fprintf(fid,'nump   % 35 - auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'denp   % 36 -auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'wtilde % 37 -price chosen by reoptimising wage-setters\n');
                fprintf(fid,'numw   % 38 - auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'denw   % 39 -auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'lz     % 40 - log of exogenous technology z\n');
                fprintf(fid,'lmp    % 41- log of monetary policy disturbance\n');
                fprintf(fid,'lbk    % 42 - log of disturbances to bank capital\n');
                fprintf(fid,'log_y  % 43 - auxiliary variable for log output\n');
                fprintf(fid,'log_I  % 44 -  auxiliary variable for log of investment\n');
                fprintf(fid,'gammag % 45 - leverage ratio set by the supervisory authority \n');
                fprintf(fid,'alpha  % 46 - endogenous probability of default\n');
                fprintf(fid,'rnot   % 47 - shadow policy rate\n');
                fprintf(fid,'CBBS % 48 - QE in percentag of output\n');
                fprintf(fid,'lqe  % 49 - log of QE disturbance\n');
                fprintf(fid,'inflexp1  % 50 - 10Year inflation expectations\n'); 

                fprintf(fid,'inflexp2  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  % 50 - 10Year inflation expectations\n');

                 fprintf(fid,'Rexp1  % 50 - 10Year yieds expectations\n');
                
                fprintf(fid,'Rexp2  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp3  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp4  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp5  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp6  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp7  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp8  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp9  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp10  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp11  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp12  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp13  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp14  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp15  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp16  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp17  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp18  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp19  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp20  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp21  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp22  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp23  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp24  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp25  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp26  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp27  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp28  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp29  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp30  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp31  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp32  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp33  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp34  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp35  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp36  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp37  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp38  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp39  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp40  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'BVaR % Bank VaR driven default probability \n');

                
                fprintf(fid,';\n');
                fprintf(fid,'varexo \n');
                fprintf(fid,'z_shk  % innovation to productivity process\n');
                fprintf(fid,'mp_shk % innovation to monetary policy process\n');
                fprintf(fid,'bk_shk % innovation to the bank capital shock\n');
                fprintf(fid,'qe_shk % innovation to QE\n');
                fprintf(fid,';\n');
%% Parameter definition 
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 2. Parameter declaration and calibration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'parameters \n');
                fprintf(fid,'habit  % Parameter of habit formation\n');
                fprintf(fid,'bet      % Discount factor\n');
                fprintf(fid,'delta   % Depreciation of physical capital\n');
                fprintf(fid,'reta     % Parameter of leisure in utility\n');
                fprintf(fid,'psi_l  % Parameter related to labour supply (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) \n');
                fprintf(fid,'elas_l % Elasticity of labour utility psi_l = 4.55 and elas_l=0.429  \n');
                fprintf(fid,'chi1 % Parameter governing capital utilization following Fernandez Villaverde et al. (2010) upsilon(u) = chi_1(u-1)+ 0.5*chi_2(u-1)^2\n');
                fprintf(fid,'chi2  % Parameter in capital utilization\n');
                fprintf(fid,'pi_ss % Steady state level of inflation\n');
                fprintf(fid,'xi_w %Parameter governing nominal rigidities and elasticities of substitution following CEE, 2005 xi_w = 21\n');
                fprintf(fid,'phi_w % Parameter governing nominal rigidities of wage setting\n');
                fprintf(fid,'mark_w % Parameter of wage markup\n');
                fprintf(fid,'eta_h % Measure of agents that are households\n');
                fprintf(fid,'eta_e % Measure of agents that are entrepreneurs\n');
                fprintf(fid,'eta_b % Measure of agents that are bankers\n');
                fprintf(fid,'xi_p % Parameter governing nominal rigidities of the intermediate producers\n');
                fprintf(fid,'phi_p % Parameter of price updating probability of intermediate producers\n');
                fprintf(fid,'mark_p % Price markup on the intermediate producers side\n');
                fprintf(fid,'theta_k % Share of capital in production\n');
                fprintf(fid,'theta_h % Share of household labor in production\n');
                fprintf(fid,'theta_e % Share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b % Share of bank labor in production\n');
                fprintf(fid,'bigR % Overall return to the investment project \n');
                fprintf(fid,'delalpha % Difference in probability of success between high and low effort\n');
                fprintf(fid,'tau_b % Survival probability of banker\n');
                fprintf(fid,'tau_e % Survival probability of entrepreneurs\n');
                fprintf(fid,'lam_r  % AR(1) parameter in the Taylor rule, for short term interest rate smoothing\n');
                fprintf(fid,'lam_pi % Parameter on the inflation target in the Taylor rule\n');
                fprintf(fid,'lam_y % Parameter of output stabilization in the Taylor rule\n');
                fprintf(fid,'bigtheta % Overall Profits\n');
                fprintf(fid,'bby % Additional capital endowment banks receive every period, as a percentage of output, set 0 by default, increased to 0.007 for the experiment Economy with More Bank Capital\n');
                fprintf(fid,'nu % Valuation mulitplier for exiting bankers consumption\n');
                fprintf(fid,'rhoz % AR(1) coefficient for the technology shock\n');
                fprintf(fid,'rhomp % AR(1) coefficient for the monetary policy\n');
                fprintf(fid,'rhobk % AR(1) coefficient of the bank capital shock\n');
                fprintf(fid,'sigmaz % Standard deviation of the technology shock\n');
                fprintf(fid,'sigmamp % Standard deviation of the monetary policy shock\n');
                fprintf(fid,'sigmabk  % Standard deviation of the bank capital shock\n');
                fprintf(fid,'alpha_ss % Steady state probability of success given high effort that is also the bank success probability\n');
                fprintf(fid,'mu_ss % Steady state of monitoring effort by banks\n');
                fprintf(fid,'% gammag_ss % Steady state level of bank leverage \n');
                fprintf(fid,'omega % Parameter linking endogenous probability of success to credit to GDP ratio\n');
                fprintf(fid,'varsigma % Parameter linking endogenous riskiness of the banking sector to total lending\n');
                fprintf(fid,'epsb % Parameter linking probability of success to monitoring\n');
                fprintf(fid,'Btopbar % Maximum level of private benefit\n');
                fprintf(fid,'Blowbar % Lower level of private benefit\n');
                fprintf(fid,'Chi % Parameter for endogenous private benefit\n');
                fprintf(fid,'CBBSp % Parameter governing the QE/Central bank balance sheet reaction\n');
                fprintf(fid,'sigmaqe % Standard deviation of QE shock\n');
                fprintf(fid,'rhoqe % AR(1) coefficient of the QE shock process\n');
                fprintf(fid,';\n');
                
%% Calibration
                fprintf(fid,'sigmaqe = %15.14f; \n',sigmaqe);
                fprintf(fid,'rhoqe = %5.4f; \n',rhoqe);
                fprintf(fid,'habit = %5.4f;  %parameter governing habit formation (CEE 2005 use 0.65)\n', habit);
                fprintf(fid,'bet = %5.4f;    %discount factor\n', bet);
                fprintf(fid,'delta = %5.4f;  %depreciation of physical capital\n', delta);
                fprintf(fid,'reta = %15.14f;\n',reta);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% parameters related to labour supply\n');
                fprintf(fid,'% (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) )\n');
                fprintf(fid,'% elas_l = 1 follows CEE(2005)\n');
                fprintf(fid,'% elas_l = 0.429 reproduces (for dynamics) our JEDC specification with log disutility\n');
                fprintf(fid,'% in either case, psi_l is set in order for work effort at ss to be 0.3\n');
                fprintf(fid,'% (this requires psi_l = 4.55 if elas_l = 0.429)\n');
                fprintf(fid,'%psi_l = 9.05;\n');
                fprintf(fid,'%elas_l = 1.0;\n');
                fprintf(fid,'psi_l = %5.4f;\n', psi_l);
                fprintf(fid,'elas_l = %5.4f;\n', elas_l);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'%parameters of monetary policy\n');
                fprintf(fid,'pi_ss = %8.7f;\n', pi_ss);
                fprintf(fid,'lam_r = %5.4f;\n', lam_r);
                fprintf(fid,'lam_pi = %5.4f;\n', lam_pi);
                fprintf(fid,'lam_y = %5.4f;\n', lam_y);
                fprintf(fid,'%lam_y = 0.1;\n');
                fprintf(fid,'Rd_temp = pi_ss/bet;\n');
                fprintf(fid,'% nominal rigidities and elasticities of substitution\n');
                fprintf(fid,'% (follows CEE, 2005)\n');
                fprintf(fid,'xi_w = %3.1f;\n', xi_w);
                fprintf(fid,'phi_w = %5.4f;\n', phi_w);
                fprintf(fid,'xi_p = %5.4f;\n',xi_p);
                fprintf(fid,'phi_p = %5.4f;\n',phi_p);
                fprintf(fid,'mark_p  = xi_p/(xi_p-1);\n');
                fprintf(fid,'mark_w = xi_w/(xi_w-1);\n');
                fprintf(fid,'eta_h = %5.4f;            % measure of agents that are households\n', eta_h);
                fprintf(fid,'eta_e = %5.4f;           % measure of agents that are entrepreneurs\n', eta_e);
                fprintf(fid,'eta_b = 1-eta_h-eta_e;    % measure of agents that are bankers\n');
                fprintf(fid,'theta_h = %15.14f;   % share of household labor in production\n', theta_h);
                fprintf(fid,'theta_k = %15.14f;       % share of capital in production\n', theta_k);
                fprintf(fid,'theta_e = (1.0-theta_h-theta_k)/2.0;    % share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b = 1.0-theta_h-theta_k-theta_e;   % share of bank labor in production\n');
                fprintf(fid,'% sector producing physical capital\n');
                fprintf(fid,'delalpha = %15.14f;\n',delalpha);
                fprintf(fid,'tau_b = %15.14f; \n',tau_b);
                fprintf(fid,'tau_e = %15.14f;\n', tau_e);
                fprintf(fid,'bigR = %15.14f; \n', bigR);
                fprintf(fid,'% In some experiments, we want to leave mu_ss unchanged at 0.025 (to compute s.s.)\n');
                fprintf(fid,'% but have mu = 0.0 for the linearization (to produce "WITH BANK CAPITAl CHANNEL" responses\n');
                fprintf(fid,'% and "NO BANK CAPITAl CHANNEL" responses)\n');
                fprintf(fid,'% in order to do that, need to disable lines 81-84 in the "steady_.m" program\n');
                fprintf(fid,'% of your dynare build\n');
                fprintf(fid,'bby = %5.4f;\n', bby);
                fprintf(fid,'               % additional capital endowment banks receive every period, as a percentage of output.\n');
                fprintf(fid,'               % (This is used for the experiments titled\n');
                fprintf(fid,'               % "Economy with More Bank Capital"): for that, set bby to  0.007\n');
                fprintf(fid,'nu = %15.14f;\n',nu);
                fprintf(fid,'% Parameters related to shock processes\n');
                fprintf(fid,'rhoz = %15.14f;    %autocorrelation of technology\n',rhoz);
                fprintf(fid,'sigmaz = %15.14f; % s.d. of innovation to technology\n',sigmaz);
                fprintf(fid,'%sigmaz = 0.0015;\n');
                fprintf(fid,'%Parameter related to capital utilisation:\n');
                fprintf(fid,'sigma_a = %15.14f;\n',sigma_a);
                fprintf(fid,'rhomp = %15.14f;  %autocorrelation of disturbances to the MP rule\n',rhomp);
                fprintf(fid,'sigmamp = %15.14f; % s.d. of innovations to these disturbances.\n',sigmamp);
                fprintf(fid,'rhobk = %15.14f;  %autocorrelation of shocks to bank capital\n',rhobk);
                fprintf(fid,'sigmabk = %15.14f; % s.d. of innovations to these disturbances.\n',rhobk);
                fprintf(fid,'%sigmabk = 0.000001;\n');
                fprintf(fid,'alpha_ss = %15.14f;\n',alpha_ss);
                fprintf(fid,'Chi =  %15.13f;            % 3.0792;       %sensitivity of entrepreneurial private benefit to monitoring intensity\n',Chi);
                fprintf(fid,'epsb = %15.13f;      %linkage between shirking and premium paid\n', epsb);
                fprintf(fid,'Btopbar =  %15.13f; %maximum private benefits from shirking;\n', Btopbar);
                fprintf(fid,'Blowbar = %5.4f; \n',Blowbar);
                fprintf(fid,'omega = %15.14f;     % Strength of response of monetary authority to deviations from credittogdp \n', omega);
                fprintf(fid,'varsigma = %15.14f;  % Strength of the endogenous link between credit to GDP devation from SS to banking sector riskiness\n', varsigma);
                fprintf(fid,'mu_ss = %15.14f;\n',mu_ss);
                fprintf(fid,'CBBSp = %15.14f;\n',CBBSp);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');               
%% Steady state computations
                fprintf(fid,'% steady-state computations:\n');
                fprintf(fid,'\n');
                fprintf(fid,'alphatemp = alpha_ss;\n');
                fprintf(fid,'mutemp = mu_ss;\n');
                fprintf(fid,'smallbtemp = Btopbar*(1+Chi*mutemp)^(-epsb);\n');
                fprintf(fid,'kk1 = delta*theta_k/(alphatemp*bigR*(1/bet-1+delta)); \n');
                fprintf(fid,'betatemp  = 1/bet;\n');
                fprintf(fid,'infl_temp = pi_ss;\n');
                fprintf(fid,'qtemp = kk1*(alphatemp*tau_b*mutemp*betatemp/delalpha-(1+mutemp+alphatemp*mutemp/(Rd_temp*delalpha)));\n');
                fprintf(fid,'qtemp = qtemp/(alphatemp*smallbtemp*kk1/(Rd_temp*delalpha)-alphatemp*bigR*kk1/Rd_temp-theta_e-theta_b-bby-alphatemp*tau_e*smallbtemp*kk1*betatemp/delalpha);\n');
                fprintf(fid,'Gtemp = 1+mutemp-(qtemp*alphatemp/Rd_temp)*(bigR-mutemp/(qtemp*delalpha)-smallbtemp/delalpha);\n');
                fprintf(fid,'IY = kk1/qtemp;\n');
                fprintf(fid,'KY = alphatemp*bigR*IY/delta; \n');
                fprintf(fid,'KeY = tau_e*alphatemp*smallbtemp*IY/delalpha;\n');
                fprintf(fid,'KbY = tau_b*alphatemp*mutemp*IY/(qtemp*delalpha);\n');
                fprintf(fid,'KhY = KY - KeY - KbY;\n');
                fprintf(fid,'CeY = (1-tau_e)*alphatemp*smallbtemp*IY*qtemp/delalpha;\n');
                fprintf(fid,'CbY = nu*(1-tau_b)*alphatemp*mutemp*IY/delalpha;\n');
                fprintf(fid,'ChY = 1 + bby - CeY - CbY  - (1+mutemp)*IY;\n');
                fprintf(fid,'essai = (1-bet*habit)*theta_h/((1-habit)*ChY*psi_l*mark_w);\n');
                fprintf(fid,'smallh = essai^(1/(1+elas_l));\n');
                fprintf(fid,'Htemp = smallh*eta_h^(xi_w/(xi_w-1));\n');
                fprintf(fid,'kk2 = (KY^(1/(1-theta_k))) * (eta_e^(theta_e/(1-theta_k)))* (eta_b^(theta_b/(1-theta_k)))* mark_p^(1/(theta_k-1));\n');
                fprintf(fid,'Ktemp = Htemp^(theta_h/(1-theta_k))* kk2;\n');
                fprintf(fid,'Ytemp = (1/mark_p)* (Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'% fixed cost parameter to ensure zero profits in s.s.\n');
                fprintf(fid,'bigtheta = (mark_p-1)*Ytemp;\n');
                fprintf(fid,'Itemp = IY*Ytemp;\n');
                fprintf(fid,'rktemp = (1/mark_p)*theta_k*(Ktemp^(theta_k-1))*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% Following Fernandez Villaverde et al. (2010) as well as others,\n');
                fprintf(fid,'% set utilisation of capital as \n');
                fprintf(fid,'%upsilon(u) = chi_1 (u - 1) + 0.5chi_2 (u - 1)^2\n');
                fprintf(fid,'%Set parameters in a way that replicates CEE (2005)\n');
                fprintf(fid,'\n');
                fprintf(fid,'chi1 = rktemp;\n');
                fprintf(fid,'chi2 = sigma_a*chi1;  \n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'w_htemp = (1/mark_p)*theta_h*(Ktemp^theta_k)*(Htemp^(theta_h-1))*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'w_etemp = (1/mark_p)*theta_e*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^(theta_e-1))*(eta_b^theta_b);\n');
                fprintf(fid,'w_btemp = (1/mark_p)*theta_b*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^(theta_b-1));\n');
                fprintf(fid,'Ketemp = KeY*Ytemp;\n');
                fprintf(fid,'Kbtemp = KbY*Ytemp;\n');
                fprintf(fid,'Khtemp = KhY*Ytemp;\n');
                fprintf(fid,'Cetemp = CeY*Ytemp;\n');
                fprintf(fid,'Cbtemp = CbY*Ytemp;\n');
                fprintf(fid,'chtemp = ChY*Ytemp/eta_h;\n');
                fprintf(fid,'bigAtemp = eta_b*w_btemp+(rktemp+qtemp*(1-delta))*Kbtemp+bby*Ytemp;\n');
                fprintf(fid,'bigNtemp = eta_e*w_etemp+(rktemp+qtemp*(1-delta))*Ketemp;\n');
                fprintf(fid,'totCtemp = Cetemp+Cbtemp+eta_h*chtemp;\n');
                fprintf(fid,'lamtemp = (1-bet*habit)/((1-habit)*(chtemp));\n');
                fprintf(fid,'smalldtemp = alphatemp*qtemp*( bigR - smallbtemp/delalpha - mutemp/(qtemp*delalpha))*Itemp/(Rd_temp*eta_b);\n');
                fprintf(fid,'ptemp = (Rd_temp-1)*lamtemp/ ( (Rd_temp-1)*lamtemp*eta_b*smalldtemp + eta_h*reta);\n');
                fprintf(fid,'mctemp = reta*ptemp/((Rd_temp-1)*lamtemp);\n');
                fprintf(fid,'Ratemp = alphatemp*qtemp*(mutemp/(qtemp*delalpha))*Itemp/bigAtemp;\n');
                fprintf(fid,'TLtemp = Itemp-bigNtemp;\n');
                fprintf(fid,'wtildetemp = w_htemp*infl_temp*eta_h^(-1/(1-xi_w));\n');
                fprintf(fid,'numwtemp =  ( ( (w_htemp*infl_temp)^(xi_w*(1+elas_l)) * Htemp^(1+elas_l) )/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denwtemp = ( (w_htemp^(xi_w)*infl_temp^(xi_w-1)*Htemp*lamtemp)/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'wtildetemp = (mark_w*psi_l)^(1/(1+xi_w*elas_l))*numwtemp/denwtemp;\n');
                fprintf(fid,'stemp = 1/mark_p;\n');
                fprintf(fid,'mgrowthtemp = infl_temp;\n');
                fprintf(fid,'expinfltemp = infl_temp;\n');
                fprintf(fid,'gYtemp = 1;\n');
                fprintf(fid,'utemp = 1;\n');
                fprintf(fid,'gammagtemp = (Itemp-bigNtemp )/bigAtemp;\n');
                %% Model
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 3. Model declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'model;  \n');
                fprintf(fid,'1/(ch - habit*ch(-1)) - bet*habit*1/(ch(+1) - habit*ch) = lam;\n');
                fprintf(fid,'reta/(mc/p) = (Rd-1)*lam;\n');
                fprintf(fid,'rk = chi1 + chi2*(u - 1);\n');
                fprintf(fid,'q*lam = bet* (lam(+1)* ( q(+1)*(1-delta) + rk(+1)*u- ( chi1*(u-1)+0.5*chi2*(u(+1)-1)^2 ) ));\n');
                fprintf(fid,'lam = bet*lam(+1)*Rd(+1)/infl(+1);\n');
                fprintf(fid,'infl = p*mgrowth/p(-1);\n');
                fprintf(fid,'wtilde = (xi_w *psi_l/(xi_w-1))^(1/(1+elas_l*xi_w)) * numw /  denw;\n');
                fprintf(fid,'numw =  ( bet*phi_w*(numw(+1)^(1+elas_l*xi_w)) + (H^(1+elas_l)) *(w_h*infl)^(xi_w*(1+elas_l)) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denw =  ( bet*phi_w*(denw(+1)^(1+elas_l*xi_w)) + lam*H*(w_h^xi_w)*(infl^(xi_w-1)) )^(1/(1+elas_l*xi_w)) ;\n');
                fprintf(fid,'infl^(1-xi_w) *w_h^(1-xi_w) = eta_h*(1-phi_w)*wtilde^(1-xi_w) + phi_w* infl(-1)^(1-xi_w) *w_h(-1)^(1-xi_w);\n');
                fprintf(fid,'ptilde = xi_p * nump/ ((xi_p - 1) * denp );\n');
                fprintf(fid,'nump = bet*phi_p*nump(+1) + lam*s*Y*infl^xi_p;\n');
                fprintf(fid,'denp = bet*phi_p*denp(+1) + lam*Y*infl^(xi_p-1);\n');
                fprintf(fid,'infl^(1-xi_p) = (1-phi_p)*ptilde^(1-xi_p) + phi_p*infl(-1)^(1-xi_p);\n');
                fprintf(fid,'rk = s * exp(lz)* theta_k * keff^(theta_k-1) * H^theta_h * eta_e^theta_e *eta_b^(theta_b);\n');
                fprintf(fid,'w_h = s * exp(lz)* theta_h * keff^(theta_k) * H^(theta_h-1) * eta_e^theta_e * eta_b^(theta_b);\n');
                fprintf(fid,'w_e = s * exp(lz)* theta_e * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e-1) * eta_b^(theta_b);\n');
                fprintf(fid,'w_b = s * exp(lz)* theta_b * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e) * eta_b^(theta_b-1);\n');
                fprintf(fid,'%I = (bigA+bigN)/G;\n');
                fprintf(fid,'bigA*Ra = alpha * mu*I/delalpha;\n');
                fprintf(fid,'%G = 1+ mu - q *alpha*( bigR - smallb/delalpha - mu/(q*delalpha) )/(Rd);\n');
                fprintf(fid,'Rd*(1-eta_h*mc)/p = q*alpha*( bigR-smallb/delalpha - mu/(q*delalpha))*I;\n');
                fprintf(fid,'Kb = tau_b*alpha*mu*I/(q*delalpha);\n');
                fprintf(fid,'Ke = tau_e*alpha*smallb*I/delalpha;\n');
                fprintf(fid,'bigA = exp(lbk)*( rk + q*(1-delta))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'%bigA = exp(lbk)*( rk + q*(1-delta*exp(lbk)))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'bigN = ( rk + q*(1-delta))*Ke(-1) + eta_e*w_e;\n');
                fprintf(fid,'Cb = (1-tau_b)*alpha*mu*I/delalpha;\n');
                fprintf(fid,'Ce = (1-tau_e)*alpha*q*smallb*I/delalpha;\n');
                fprintf(fid,'eta_h *ch + Ce + Cb + I + I*mu = Y;\n');
                fprintf(fid,'K = (1-delta)*K(-1) + alpha*bigR*I;\n');
                fprintf(fid,'log(rnot/steady_state(rnot)) = lam_r*log( rnot(-1)/steady_state(rnot) ) + (1-lam_r) * ( lam_pi*log(infl/steady_state(infl)) + lam_y*log(Y/steady_state(Y)) ) + lmp;\n');
                
                %% Attention Difference!
                fprintf(fid,'Rd = 1;\n');
                
                %% Ok
                fprintf(fid,'Y = exp(lz)* (keff^theta_k)*(H^theta_h)*(eta_e^theta_e)*(eta_b^theta_b) - bigtheta;\n');
                fprintf(fid,'%CA = bigA/((1+mu)*I-bigN);\n');
                fprintf(fid,'eta_b* smalld = (1-eta_h*mc)/p;\n');
                fprintf(fid,'keff = u*( K(-1) - Ke(-1) - Kb(-1) ) + Ke(-1) + Kb(-1);\n');
                fprintf(fid,'expinfl = infl(+1);\n');
                fprintf(fid,'gY = Y/Y(-1);\n');
                fprintf(fid,'TL = I - bigN;\n');
                fprintf(fid,'totC = eta_h *ch + Ce + Cb;\n');
                fprintf(fid,'lz = rhoz*lz(-1)+ z_shk;\n');
                fprintf(fid,'lmp = rhomp*lmp(-1)+ mp_shk;\n');
                fprintf(fid,'lbk = rhobk*lbk(-1)- bk_shk;\n');
                fprintf(fid,'log_y = log(Y);\n');
                fprintf(fid,'log_I = log(I);\n');
                fprintf(fid,'smallb = Btopbar *(1+Chi*mu)^(-epsb);\n');
                fprintf(fid,'alpha = 1 - (1-alpha_ss) - ((I-bigN)/Y-(steady_state(I)-steady_state(bigN))/steady_state(Y))*varsigma ; %Endogenous riskiness of the banking sector\n');
                fprintf(fid,'gammag = steady_state(gammag) + omega*(BVaR-steady_state(BVaR)); % Regulatory authority rule\n');
                fprintf(fid,'I =gammag * bigA + bigN + CBBS*Y;  % Equtaion 43 on page 21\n');
                fprintf(fid,'gammag = 1 + (q*Ra/Rd)*(delalpha*bigR-smallb-mu/q)/mu - Ra*delalpha/alpha; % Equation 15 on page 9 in CMM(2011)\n');
                fprintf(fid,'%CBBS = lqe/steady_state(Y);\n');
                fprintf(fid,'%CBBS =  CBBSp*((I-bigN)/Y-(steady_state(I)-steady_state(bigN))/steady_state(Y)) + lqe/steady_state(Y);\n');
                
                %% Attention, difference!
                fprintf(fid,'CBBS =  CBBSp*( (bigA-steady_state(bigA))/steady_state(Y) + (bigN-steady_state(bigN))/steady_state(Y)	 ) + lqe/steady_state(Y);\n');
                
                %% Attention
                fprintf(fid,'lqe = rhoqe*lqe(-1)+ qe_shk;\n');
                fprintf(fid,'inflexp1  = infl(+1); % 50 - 10Year inflation expectations\n');    
                fprintf(fid,'inflexp2  = inflexp1(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  = inflexp2(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  = inflexp3(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  = inflexp4(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  = inflexp5(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  = inflexp6(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  = inflexp7(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  = inflexp8(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  = inflexp9(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  = inflexp10(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  = inflexp11(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  = inflexp12(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  = inflexp13(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  = inflexp14(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  = inflexp15(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  = inflexp16(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  = inflexp17(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  = inflexp18(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  = inflexp19(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  = inflexp20(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  = inflexp21(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  = inflexp22(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  = inflexp23(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  = inflexp24(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  = inflexp25(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  = inflexp26(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  = inflexp27(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  = inflexp28(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  = inflexp29(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  = inflexp30(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  = inflexp31(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  = inflexp32(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  = inflexp33(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  = inflexp34(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  = inflexp35(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  = inflexp36(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  = inflexp37(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  = inflexp38(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  = inflexp39(+1); % 50 - 10Year inflation expectations\n');
       
                fprintf(fid,'Rexp1  = Rd(+1); % 50 - 10Year Yields expectations\n');    
                fprintf(fid,'Rexp2  = Rexp1(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp3  = Rexp2(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp4  = Rexp3(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp5  = Rexp4(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp6  = Rexp5(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp7  = Rexp6(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp8  = Rexp7(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp9  = Rexp8(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp10  = Rexp9(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp11  = Rexp10(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp12  = Rexp11(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp13  = Rexp12(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp14  = Rexp13(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp15  = Rexp14(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp16  = Rexp15(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp17  = Rexp16(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp18  = Rexp17(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp19  = Rexp18(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp20  = Rexp19(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp21  = Rexp20(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp22  = Rexp21(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp23  = Rexp22(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp24  = Rexp23(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp25  = Rexp24(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp26  = Rexp25(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp27  = Rexp26(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp28  = Rexp27(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp29  = Rexp28(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp30  = Rexp29(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp31  = Rexp30(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp32  = Rexp31(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp33  = Rexp32(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp34  = Rexp33(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp35  = Rexp34(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp36  = Rexp35(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp37  = Rexp36(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp38  = Rexp37(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp39  = Rexp38(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp40  = Rexp39(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'BVaR = mu/(q*(exp(0.25)-1)); \n');

                
                fprintf(fid,'end;\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 4. Initial values and steady state\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'%resid;\n');
                fprintf(fid,'%steady;  \n');
                fprintf(fid,'%check;                    \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 5. Shock declaration  \n');
                fprintf(fid,'//                       \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'shocks;\n');
                fprintf(fid,'var z_shk = sigmaz^2;\n');
                fprintf(fid,'var mp_shk = sigmamp^2;\n');
                fprintf(fid,'var bk_shk = sigmabk^2;\n');
                fprintf(fid,'var qe_shk = sigmaqe^2;\n');
                fprintf(fid,'end;\n');
                fprintf(fid,'%stoch_simul(order=1,irf = 0,hp_filter = 1600)  Y I q gammag bigA TL bigN Rd infl mu alpha;\n');
                fprintf(fid,'%options_.debug = 1;\n');
                fprintf(fid,'%options_.pruning=1;\n');
                fprintf(fid,'%stoch_simul(order=2,replic = 50,irf = 40,noprint,nograph,hp_filter = 1600);\n');
    
fclose('all');   
%% Opening the model with ZLB and no Macropru
 fid = fopen(['nomacropruFMzlb.mod'],'w+');
%% Writing the mod file for simulation
    
                fprintf(fid,'// A Dynare version of Counter cyclical Monetary policy at the ZLB based on \n');
                fprintf(fid,'// Meh and Moran. 2010. "The Role of Bank Capital in the Propagation of Shocks"\n');
                fprintf(fid,'// JEDC 34: 555-576\n');
                fprintf(fid,'// Written by Matyas Farkas, 2019\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 1. Variable declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'var \n');
                fprintf(fid,'ch    % 1- household consumption\n');
                fprintf(fid,'Ce    % 2- entrepreneurial consumption\n');
                fprintf(fid,'Cb    % 3- banking consumption\n');
                fprintf(fid,'H     % 4- aggregate (composite) labour input\n');
                fprintf(fid,'Y     % 5- Output\n');
                fprintf(fid,'I     % 6- Investment \n');
                fprintf(fid,'bigN  % 7- entrepreneurial net worth \n');
                fprintf(fid,'bigA  % 8- net worth of banking sector (bank capital)\n');
                fprintf(fid,'smallb % 9 - private benefit\n');
                fprintf(fid,'q     % 10- relative price of capital goods\n');
                fprintf(fid,'rk    % 11- rental rate on capital\n');
                fprintf(fid,'infl  % 12 - gross rate of quarterly inflation\n');
                fprintf(fid,'w_h   % 13 - wage rate (households)\n');
                fprintf(fid,'w_e   % 14 - wage rate (entrepreneurs)\n');
                fprintf(fid,'w_b   % 15 - wage rate (bankers)\n');
                fprintf(fid,'Rd    % 16 - gross, nominal rate of interest\n');
                fprintf(fid,'Ra    % 17 - gross return on bank capital\n');
                fprintf(fid,'lam   % 18 - marginal utility of consumption\n');
                fprintf(fid,'mu     % 19 - endogenous monitoring intensity\n');
                fprintf(fid,'p     % 20 - inverse of real money balances\n');
                fprintf(fid,'TL    % 21 -Aggregate bank lending in the economy\n');
                fprintf(fid,'mc    % 22 - fraction of HH''s financiel assets held as currency\n');
                fprintf(fid,'s     % 23 -marginal costs\n');
                fprintf(fid,'mgrowth % 24- growth rate of money\n');
                fprintf(fid,'expinfl % 25 - expected rate of inflation at time t+1\n');
                fprintf(fid,'smalld  % 26 - real value of household deposits  \n');
                fprintf(fid,'gY   % 27- gross rate of output growth\n');
                fprintf(fid,'totC % 28 - aggregate consumption\n');
                fprintf(fid,'u    % 29 - utilization rate on physical capital \n');
                fprintf(fid,'keff  % 30 - effective capital services\n');
                fprintf(fid,'K     % 31 - total physical capital\n');
                fprintf(fid,'Kb    % 32 - holdings of physical capital by banking sector\n');
                fprintf(fid,'Ke    % 33 - holdings of physical capital by entrepreneurial sector\n');
                fprintf(fid,'ptilde % 34 - price chosen by reoptimising price-setters\n');
                fprintf(fid,'nump   % 35 - auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'denp   % 36 -auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'wtilde % 37 -price chosen by reoptimising wage-setters\n');
                fprintf(fid,'numw   % 38 - auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'denw   % 39 -auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'lz     % 40 - log of exogenous technology z\n');
                fprintf(fid,'lmp    % 41- log of monetary policy disturbance\n');
                fprintf(fid,'lbk    % 42 - log of disturbances to bank capital\n');
                fprintf(fid,'log_y  % 43 - auxiliary variable for log output\n');
                fprintf(fid,'log_I  % 44 -  auxiliary variable for log of investment\n');
                fprintf(fid,'gammag % 45 - leverage ratio set by the supervisory authority \n');
                fprintf(fid,'alpha  % 46 - endogenous probability of default\n');
                fprintf(fid,'rnot   % 47 - shadow policy rate\n');
                fprintf(fid,'CBBS % 48 - QE in percentag of output\n');
                fprintf(fid,'lqe  % 49 - log of QE disturbance\n');
                fprintf(fid,'inflexp1  % 50 - 10Year inflation expectations\n'); 

                fprintf(fid,'inflexp2  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  % 50 - 10Year inflation expectations\n');

                 fprintf(fid,'Rexp1  % 50 - 10Year yieds expectations\n');
                
                fprintf(fid,'Rexp2  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp3  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp4  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp5  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp6  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp7  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp8  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp9  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp10  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp11  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp12  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp13  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp14  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp15  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp16  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp17  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp18  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp19  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp20  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp21  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp22  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp23  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp24  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp25  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp26  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp27  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp28  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp29  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp30  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp31  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp32  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp33  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp34  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp35  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp36  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp37  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp38  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp39  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp40  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'BVaR % Bank VaR driven default probability \n');

                
                fprintf(fid,';\n');
                fprintf(fid,'varexo \n');
                fprintf(fid,'z_shk  % innovation to productivity process\n');
                fprintf(fid,'mp_shk % innovation to monetary policy process\n');
                fprintf(fid,'bk_shk % innovation to the bank capital shock\n');
                fprintf(fid,'qe_shk % innovation to QE\n');
                fprintf(fid,';\n');
%% Parameter definition 
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 2. Parameter declaration and calibration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'parameters \n');
                fprintf(fid,'habit  % Parameter of habit formation\n');
                fprintf(fid,'bet      % Discount factor\n');
                fprintf(fid,'delta   % Depreciation of physical capital\n');
                fprintf(fid,'reta     % Parameter of leisure in utility\n');
                fprintf(fid,'psi_l  % Parameter related to labour supply (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) \n');
                fprintf(fid,'elas_l % Elasticity of labour utility psi_l = 4.55 and elas_l=0.429  \n');
                fprintf(fid,'chi1 % Parameter governing capital utilization following Fernandez Villaverde et al. (2010) upsilon(u) = chi_1(u-1)+ 0.5*chi_2(u-1)^2\n');
                fprintf(fid,'chi2  % Parameter in capital utilization\n');
                fprintf(fid,'pi_ss % Steady state level of inflation\n');
                fprintf(fid,'xi_w %Parameter governing nominal rigidities and elasticities of substitution following CEE, 2005 xi_w = 21\n');
                fprintf(fid,'phi_w % Parameter governing nominal rigidities of wage setting\n');
                fprintf(fid,'mark_w % Parameter of wage markup\n');
                fprintf(fid,'eta_h % Measure of agents that are households\n');
                fprintf(fid,'eta_e % Measure of agents that are entrepreneurs\n');
                fprintf(fid,'eta_b % Measure of agents that are bankers\n');
                fprintf(fid,'xi_p % Parameter governing nominal rigidities of the intermediate producers\n');
                fprintf(fid,'phi_p % Parameter of price updating probability of intermediate producers\n');
                fprintf(fid,'mark_p % Price markup on the intermediate producers side\n');
                fprintf(fid,'theta_k % Share of capital in production\n');
                fprintf(fid,'theta_h % Share of household labor in production\n');
                fprintf(fid,'theta_e % Share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b % Share of bank labor in production\n');
                fprintf(fid,'bigR % Overall return to the investment project \n');
                fprintf(fid,'delalpha % Difference in probability of success between high and low effort\n');
                fprintf(fid,'tau_b % Survival probability of banker\n');
                fprintf(fid,'tau_e % Survival probability of entrepreneurs\n');
                fprintf(fid,'lam_r  % AR(1) parameter in the Taylor rule, for short term interest rate smoothing\n');
                fprintf(fid,'lam_pi % Parameter on the inflation target in the Taylor rule\n');
                fprintf(fid,'lam_y % Parameter of output stabilization in the Taylor rule\n');
                fprintf(fid,'bigtheta % Overall Profits\n');
                fprintf(fid,'bby % Additional capital endowment banks receive every period, as a percentage of output, set 0 by default, increased to 0.007 for the experiment Economy with More Bank Capital\n');
                fprintf(fid,'nu % Valuation mulitplier for exiting bankers consumption\n');
                fprintf(fid,'rhoz % AR(1) coefficient for the technology shock\n');
                fprintf(fid,'rhomp % AR(1) coefficient for the monetary policy\n');
                fprintf(fid,'rhobk % AR(1) coefficient of the bank capital shock\n');
                fprintf(fid,'sigmaz % Standard deviation of the technology shock\n');
                fprintf(fid,'sigmamp % Standard deviation of the monetary policy shock\n');
                fprintf(fid,'sigmabk  % Standard deviation of the bank capital shock\n');
                fprintf(fid,'alpha_ss % Steady state probability of success given high effort that is also the bank success probability\n');
                fprintf(fid,'mu_ss % Steady state of monitoring effort by banks\n');
                fprintf(fid,'% gammag_ss % Steady state level of bank leverage \n');
                fprintf(fid,'omega % Parameter linking endogenous probability of success to credit to GDP ratio\n');
                fprintf(fid,'varsigma % Parameter linking endogenous riskiness of the banking sector to total lending\n');
                fprintf(fid,'epsb % Parameter linking probability of success to monitoring\n');
                fprintf(fid,'Btopbar % Maximum level of private benefit\n');
                fprintf(fid,'Blowbar % Lower level of private benefit\n');
                fprintf(fid,'Chi % Parameter for endogenous private benefit\n');
                fprintf(fid,'CBBSp % Parameter governing the QE/Central bank balance sheet reaction\n');
                fprintf(fid,'sigmaqe % Standard deviation of QE shock\n');
                fprintf(fid,'rhoqe % AR(1) coefficient of the QE shock process\n');
                fprintf(fid,';\n');
                
%% Calibration
                fprintf(fid,'sigmaqe = %15.14f; \n',sigmaqe);
                fprintf(fid,'rhoqe = %5.4f; \n',rhoqe);
                fprintf(fid,'habit = %5.4f;  %parameter governing habit formation (CEE 2005 use 0.65)\n', habit);
                fprintf(fid,'bet = %5.4f;    %discount factor\n', bet);
                fprintf(fid,'delta = %5.4f;  %depreciation of physical capital\n', delta);
                fprintf(fid,'reta = %15.14f;\n',reta);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% parameters related to labour supply\n');
                fprintf(fid,'% (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) )\n');
                fprintf(fid,'% elas_l = 1 follows CEE(2005)\n');
                fprintf(fid,'% elas_l = 0.429 reproduces (for dynamics) our JEDC specification with log disutility\n');
                fprintf(fid,'% in either case, psi_l is set in order for work effort at ss to be 0.3\n');
                fprintf(fid,'% (this requires psi_l = 4.55 if elas_l = 0.429)\n');
                fprintf(fid,'%psi_l = 9.05;\n');
                fprintf(fid,'%elas_l = 1.0;\n');
                fprintf(fid,'psi_l = %5.4f;\n', psi_l);
                fprintf(fid,'elas_l = %5.4f;\n', elas_l);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'%parameters of monetary policy\n');
                fprintf(fid,'pi_ss = %8.7f;\n', pi_ss);
                fprintf(fid,'lam_r = %5.4f;\n', lam_r);
                fprintf(fid,'lam_pi = %5.4f;\n', lam_pi);
                fprintf(fid,'lam_y = %5.4f;\n', lam_y);
                fprintf(fid,'%lam_y = 0.1;\n');
                fprintf(fid,'Rd_temp = pi_ss/bet;\n');
                fprintf(fid,'% nominal rigidities and elasticities of substitution\n');
                fprintf(fid,'% (follows CEE, 2005)\n');
                fprintf(fid,'xi_w = %3.1f;\n', xi_w);
                fprintf(fid,'phi_w = %5.4f;\n', phi_w);
                fprintf(fid,'xi_p = %5.4f;\n',xi_p);
                fprintf(fid,'phi_p = %5.4f;\n',phi_p);
                fprintf(fid,'mark_p  = xi_p/(xi_p-1);\n');
                fprintf(fid,'mark_w = xi_w/(xi_w-1);\n');
                fprintf(fid,'eta_h = %5.4f;            % measure of agents that are households\n', eta_h);
                fprintf(fid,'eta_e = %5.4f;           % measure of agents that are entrepreneurs\n', eta_e);
                fprintf(fid,'eta_b = 1-eta_h-eta_e;    % measure of agents that are bankers\n');
                fprintf(fid,'theta_h = %15.14f;   % share of household labor in production\n', theta_h);
                fprintf(fid,'theta_k = %15.14f;       % share of capital in production\n', theta_k);
                fprintf(fid,'theta_e = (1.0-theta_h-theta_k)/2.0;    % share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b = 1.0-theta_h-theta_k-theta_e;   % share of bank labor in production\n');
                fprintf(fid,'% sector producing physical capital\n');
                fprintf(fid,'delalpha = %15.14f;\n',delalpha);
                fprintf(fid,'tau_b = %15.14f; \n',tau_b);
                fprintf(fid,'tau_e = %15.14f;\n', tau_e);
                fprintf(fid,'bigR = %15.14f; \n', bigR);
                fprintf(fid,'% In some experiments, we want to leave mu_ss unchanged at 0.025 (to compute s.s.)\n');
                fprintf(fid,'% but have mu = 0.0 for the linearization (to produce "WITH BANK CAPITAl CHANNEL" responses\n');
                fprintf(fid,'% and "NO BANK CAPITAl CHANNEL" responses)\n');
                fprintf(fid,'% in order to do that, need to disable lines 81-84 in the "steady_.m" program\n');
                fprintf(fid,'% of your dynare build\n');
                fprintf(fid,'bby = %5.4f;\n', bby);
                fprintf(fid,'               % additional capital endowment banks receive every period, as a percentage of output.\n');
                fprintf(fid,'               % (This is used for the experiments titled\n');
                fprintf(fid,'               % "Economy with More Bank Capital"): for that, set bby to  0.007\n');
                fprintf(fid,'nu = %15.14f;\n',nu);
                fprintf(fid,'% Parameters related to shock processes\n');
                fprintf(fid,'rhoz = %15.14f;    %autocorrelation of technology\n',rhoz);
                fprintf(fid,'sigmaz = %15.14f; % s.d. of innovation to technology\n',sigmaz);
                fprintf(fid,'%sigmaz = 0.0015;\n');
                fprintf(fid,'%Parameter related to capital utilisation:\n');
                fprintf(fid,'sigma_a = %15.14f;\n',sigma_a);
                fprintf(fid,'rhomp = %15.14f;  %autocorrelation of disturbances to the MP rule\n',rhomp);
                fprintf(fid,'sigmamp = %15.14f; % s.d. of innovations to these disturbances.\n',sigmamp);
                fprintf(fid,'rhobk = %15.14f;  %autocorrelation of shocks to bank capital\n',rhobk);
                fprintf(fid,'sigmabk = %15.14f; % s.d. of innovations to these disturbances.\n',rhobk);
                fprintf(fid,'%sigmabk = 0.000001;\n');
                fprintf(fid,'alpha_ss = %15.14f;\n',alpha_ss);
                fprintf(fid,'Chi =  %15.13f;            % 3.0792;       %sensitivity of entrepreneurial private benefit to monitoring intensity\n',Chi);
                fprintf(fid,'epsb = %15.13f;      %linkage between shirking and premium paid\n', epsb);
                fprintf(fid,'Btopbar =  %15.13f; %maximum private benefits from shirking;\n', Btopbar);
                fprintf(fid,'Blowbar = %5.4f; \n',Blowbar);
                fprintf(fid,'omega = 0;     % Strength of response of monetary authority to deviations from credittogdp \n');
                fprintf(fid,'varsigma = %15.14f;  % Strength of the endogenous link between credit to GDP devation from SS to banking sector riskiness\n', varsigma);
                fprintf(fid,'mu_ss = %15.14f;\n',mu_ss);
                fprintf(fid,'CBBSp = %15.14f;\n',CBBSp);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');               
%% Steady state computations
                fprintf(fid,'% steady-state computations:\n');
                fprintf(fid,'\n');
                fprintf(fid,'alphatemp = alpha_ss;\n');
                fprintf(fid,'mutemp = mu_ss;\n');
                fprintf(fid,'smallbtemp = Btopbar*(1+Chi*mutemp)^(-epsb);\n');
                fprintf(fid,'kk1 = delta*theta_k/(alphatemp*bigR*(1/bet-1+delta)); \n');
                fprintf(fid,'betatemp  = 1/bet;\n');
                fprintf(fid,'infl_temp = pi_ss;\n');
                fprintf(fid,'qtemp = kk1*(alphatemp*tau_b*mutemp*betatemp/delalpha-(1+mutemp+alphatemp*mutemp/(Rd_temp*delalpha)));\n');
                fprintf(fid,'qtemp = qtemp/(alphatemp*smallbtemp*kk1/(Rd_temp*delalpha)-alphatemp*bigR*kk1/Rd_temp-theta_e-theta_b-bby-alphatemp*tau_e*smallbtemp*kk1*betatemp/delalpha);\n');
                fprintf(fid,'Gtemp = 1+mutemp-(qtemp*alphatemp/Rd_temp)*(bigR-mutemp/(qtemp*delalpha)-smallbtemp/delalpha);\n');
                fprintf(fid,'IY = kk1/qtemp;\n');
                fprintf(fid,'KY = alphatemp*bigR*IY/delta; \n');
                fprintf(fid,'KeY = tau_e*alphatemp*smallbtemp*IY/delalpha;\n');
                fprintf(fid,'KbY = tau_b*alphatemp*mutemp*IY/(qtemp*delalpha);\n');
                fprintf(fid,'KhY = KY - KeY - KbY;\n');
                fprintf(fid,'CeY = (1-tau_e)*alphatemp*smallbtemp*IY*qtemp/delalpha;\n');
                fprintf(fid,'CbY = nu*(1-tau_b)*alphatemp*mutemp*IY/delalpha;\n');
                fprintf(fid,'ChY = 1 + bby - CeY - CbY  - (1+mutemp)*IY;\n');
                fprintf(fid,'essai = (1-bet*habit)*theta_h/((1-habit)*ChY*psi_l*mark_w);\n');
                fprintf(fid,'smallh = essai^(1/(1+elas_l));\n');
                fprintf(fid,'Htemp = smallh*eta_h^(xi_w/(xi_w-1));\n');
                fprintf(fid,'kk2 = (KY^(1/(1-theta_k))) * (eta_e^(theta_e/(1-theta_k)))* (eta_b^(theta_b/(1-theta_k)))* mark_p^(1/(theta_k-1));\n');
                fprintf(fid,'Ktemp = Htemp^(theta_h/(1-theta_k))* kk2;\n');
                fprintf(fid,'Ytemp = (1/mark_p)* (Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'% fixed cost parameter to ensure zero profits in s.s.\n');
                fprintf(fid,'bigtheta = (mark_p-1)*Ytemp;\n');
                fprintf(fid,'Itemp = IY*Ytemp;\n');
                fprintf(fid,'rktemp = (1/mark_p)*theta_k*(Ktemp^(theta_k-1))*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% Following Fernandez Villaverde et al. (2010) as well as others,\n');
                fprintf(fid,'% set utilisation of capital as \n');
                fprintf(fid,'%upsilon(u) = chi_1 (u - 1) + 0.5chi_2 (u - 1)^2\n');
                fprintf(fid,'%Set parameters in a way that replicates CEE (2005)\n');
                fprintf(fid,'\n');
                fprintf(fid,'chi1 = rktemp;\n');
                fprintf(fid,'chi2 = sigma_a*chi1;  \n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'w_htemp = (1/mark_p)*theta_h*(Ktemp^theta_k)*(Htemp^(theta_h-1))*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'w_etemp = (1/mark_p)*theta_e*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^(theta_e-1))*(eta_b^theta_b);\n');
                fprintf(fid,'w_btemp = (1/mark_p)*theta_b*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^(theta_b-1));\n');
                fprintf(fid,'Ketemp = KeY*Ytemp;\n');
                fprintf(fid,'Kbtemp = KbY*Ytemp;\n');
                fprintf(fid,'Khtemp = KhY*Ytemp;\n');
                fprintf(fid,'Cetemp = CeY*Ytemp;\n');
                fprintf(fid,'Cbtemp = CbY*Ytemp;\n');
                fprintf(fid,'chtemp = ChY*Ytemp/eta_h;\n');
                fprintf(fid,'bigAtemp = eta_b*w_btemp+(rktemp+qtemp*(1-delta))*Kbtemp+bby*Ytemp;\n');
                fprintf(fid,'bigNtemp = eta_e*w_etemp+(rktemp+qtemp*(1-delta))*Ketemp;\n');
                fprintf(fid,'totCtemp = Cetemp+Cbtemp+eta_h*chtemp;\n');
                fprintf(fid,'lamtemp = (1-bet*habit)/((1-habit)*(chtemp));\n');
                fprintf(fid,'smalldtemp = alphatemp*qtemp*( bigR - smallbtemp/delalpha - mutemp/(qtemp*delalpha))*Itemp/(Rd_temp*eta_b);\n');
                fprintf(fid,'ptemp = (Rd_temp-1)*lamtemp/ ( (Rd_temp-1)*lamtemp*eta_b*smalldtemp + eta_h*reta);\n');
                fprintf(fid,'mctemp = reta*ptemp/((Rd_temp-1)*lamtemp);\n');
                fprintf(fid,'Ratemp = alphatemp*qtemp*(mutemp/(qtemp*delalpha))*Itemp/bigAtemp;\n');
                fprintf(fid,'TLtemp = Itemp-bigNtemp;\n');
                fprintf(fid,'wtildetemp = w_htemp*infl_temp*eta_h^(-1/(1-xi_w));\n');
                fprintf(fid,'numwtemp =  ( ( (w_htemp*infl_temp)^(xi_w*(1+elas_l)) * Htemp^(1+elas_l) )/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denwtemp = ( (w_htemp^(xi_w)*infl_temp^(xi_w-1)*Htemp*lamtemp)/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'wtildetemp = (mark_w*psi_l)^(1/(1+xi_w*elas_l))*numwtemp/denwtemp;\n');
                fprintf(fid,'stemp = 1/mark_p;\n');
                fprintf(fid,'mgrowthtemp = infl_temp;\n');
                fprintf(fid,'expinfltemp = infl_temp;\n');
                fprintf(fid,'gYtemp = 1;\n');
                fprintf(fid,'utemp = 1;\n');
                fprintf(fid,'gammagtemp = (Itemp-bigNtemp )/bigAtemp;\n');
                %% Model
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 3. Model declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'model;  \n');
                fprintf(fid,'1/(ch - habit*ch(-1)) - bet*habit*1/(ch(+1) - habit*ch) = lam;\n');
                fprintf(fid,'reta/(mc/p) = (Rd-1)*lam;\n');
                fprintf(fid,'rk = chi1 + chi2*(u - 1);\n');
                fprintf(fid,'q*lam = bet* (lam(+1)* ( q(+1)*(1-delta) + rk(+1)*u- ( chi1*(u-1)+0.5*chi2*(u(+1)-1)^2 ) ));\n');
                fprintf(fid,'lam = bet*lam(+1)*Rd(+1)/infl(+1);\n');
                fprintf(fid,'infl = p*mgrowth/p(-1);\n');
                fprintf(fid,'wtilde = (xi_w *psi_l/(xi_w-1))^(1/(1+elas_l*xi_w)) * numw /  denw;\n');
                fprintf(fid,'numw =  ( bet*phi_w*(numw(+1)^(1+elas_l*xi_w)) + (H^(1+elas_l)) *(w_h*infl)^(xi_w*(1+elas_l)) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denw =  ( bet*phi_w*(denw(+1)^(1+elas_l*xi_w)) + lam*H*(w_h^xi_w)*(infl^(xi_w-1)) )^(1/(1+elas_l*xi_w)) ;\n');
                fprintf(fid,'infl^(1-xi_w) *w_h^(1-xi_w) = eta_h*(1-phi_w)*wtilde^(1-xi_w) + phi_w* infl(-1)^(1-xi_w) *w_h(-1)^(1-xi_w);\n');
                fprintf(fid,'ptilde = xi_p * nump/ ((xi_p - 1) * denp );\n');
                fprintf(fid,'nump = bet*phi_p*nump(+1) + lam*s*Y*infl^xi_p;\n');
                fprintf(fid,'denp = bet*phi_p*denp(+1) + lam*Y*infl^(xi_p-1);\n');
                fprintf(fid,'infl^(1-xi_p) = (1-phi_p)*ptilde^(1-xi_p) + phi_p*infl(-1)^(1-xi_p);\n');
                fprintf(fid,'rk = s * exp(lz)* theta_k * keff^(theta_k-1) * H^theta_h * eta_e^theta_e *eta_b^(theta_b);\n');
                fprintf(fid,'w_h = s * exp(lz)* theta_h * keff^(theta_k) * H^(theta_h-1) * eta_e^theta_e * eta_b^(theta_b);\n');
                fprintf(fid,'w_e = s * exp(lz)* theta_e * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e-1) * eta_b^(theta_b);\n');
                fprintf(fid,'w_b = s * exp(lz)* theta_b * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e) * eta_b^(theta_b-1);\n');
                fprintf(fid,'%I = (bigA+bigN)/G;\n');
                fprintf(fid,'bigA*Ra = alpha * mu*I/delalpha;\n');
                fprintf(fid,'%G = 1+ mu - q *alpha*( bigR - smallb/delalpha - mu/(q*delalpha) )/(Rd);\n');
                fprintf(fid,'Rd*(1-eta_h*mc)/p = q*alpha*( bigR-smallb/delalpha - mu/(q*delalpha))*I;\n');
                fprintf(fid,'Kb = tau_b*alpha*mu*I/(q*delalpha);\n');
                fprintf(fid,'Ke = tau_e*alpha*smallb*I/delalpha;\n');
                fprintf(fid,'bigA = exp(lbk)*( rk + q*(1-delta))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'%bigA = exp(lbk)*( rk + q*(1-delta*exp(lbk)))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'bigN = ( rk + q*(1-delta))*Ke(-1) + eta_e*w_e;\n');
                fprintf(fid,'Cb = (1-tau_b)*alpha*mu*I/delalpha;\n');
                fprintf(fid,'Ce = (1-tau_e)*alpha*q*smallb*I/delalpha;\n');
                fprintf(fid,'eta_h *ch + Ce + Cb + I + I*mu = Y;\n');
                fprintf(fid,'K = (1-delta)*K(-1) + alpha*bigR*I;\n');
                fprintf(fid,'log(rnot/steady_state(rnot)) = lam_r*log( rnot(-1)/steady_state(rnot) ) + (1-lam_r) * ( lam_pi*log(infl/steady_state(infl)) + lam_y*log(Y/steady_state(Y)) ) + lmp;\n');
                
                %% Attention Difference!
                fprintf(fid,'Rd = 1;\n');
                
                %% Ok
                fprintf(fid,'Y = exp(lz)* (keff^theta_k)*(H^theta_h)*(eta_e^theta_e)*(eta_b^theta_b) - bigtheta;\n');
                fprintf(fid,'%CA = bigA/((1+mu)*I-bigN);\n');
                fprintf(fid,'eta_b* smalld = (1-eta_h*mc)/p;\n');
                fprintf(fid,'keff = u*( K(-1) - Ke(-1) - Kb(-1) ) + Ke(-1) + Kb(-1);\n');
                fprintf(fid,'expinfl = infl(+1);\n');
                fprintf(fid,'gY = Y/Y(-1);\n');
                fprintf(fid,'TL = I - bigN;\n');
                fprintf(fid,'totC = eta_h *ch + Ce + Cb;\n');
                fprintf(fid,'lz = rhoz*lz(-1)+ z_shk;\n');
                fprintf(fid,'lmp = rhomp*lmp(-1)+ mp_shk;\n');
                fprintf(fid,'lbk = rhobk*lbk(-1)- bk_shk;\n');
                fprintf(fid,'log_y = log(Y);\n');
                fprintf(fid,'log_I = log(I);\n');
                fprintf(fid,'smallb = Btopbar *(1+Chi*mu)^(-epsb);\n');
                fprintf(fid,'alpha = 1 - (1-alpha_ss) - ((I-bigN)/Y-(steady_state(I)-steady_state(bigN))/steady_state(Y))*varsigma ; %Endogenous riskiness of the banking sector\n');
                               %% Attention, difference!

                fprintf(fid,'gammag = steady_state(gammag)+2.5; % Regulatory authority rule\n');

                 
                                %% Attention, difference!

                fprintf(fid,'I =gammag * bigA + bigN + CBBS*Y;  % Equtaion 43 on page 21\n');
                fprintf(fid,'gammag = 1 + (q*Ra/Rd)*(delalpha*bigR-smallb-mu/q)/mu - Ra*delalpha/alpha; % Equation 15 on page 9 in CMM(2011)\n');
                fprintf(fid,'%CBBS = lqe/steady_state(Y);\n');
                fprintf(fid,'%CBBS =  CBBSp*((I-bigN)/Y-(steady_state(I)-steady_state(bigN))/steady_state(Y)) + lqe/steady_state(Y);\n');
                
                %% Attention, difference!
                fprintf(fid,'CBBS =   CBBSp*( (bigA-steady_state(bigA))/steady_state(Y) + (bigN-steady_state(bigN))/steady_state(Y)	 ) + lqe/steady_state(Y);\n');
                
                %% Attention
                fprintf(fid,'lqe = rhoqe*lqe(-1)+ qe_shk;\n');
                fprintf(fid,'inflexp1  = infl(+1); % 50 - 10Year inflation expectations\n');    
                fprintf(fid,'inflexp2  = inflexp1(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  = inflexp2(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  = inflexp3(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  = inflexp4(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  = inflexp5(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  = inflexp6(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  = inflexp7(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  = inflexp8(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  = inflexp9(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  = inflexp10(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  = inflexp11(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  = inflexp12(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  = inflexp13(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  = inflexp14(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  = inflexp15(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  = inflexp16(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  = inflexp17(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  = inflexp18(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  = inflexp19(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  = inflexp20(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  = inflexp21(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  = inflexp22(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  = inflexp23(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  = inflexp24(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  = inflexp25(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  = inflexp26(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  = inflexp27(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  = inflexp28(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  = inflexp29(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  = inflexp30(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  = inflexp31(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  = inflexp32(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  = inflexp33(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  = inflexp34(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  = inflexp35(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  = inflexp36(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  = inflexp37(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  = inflexp38(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  = inflexp39(+1); % 50 - 10Year inflation expectations\n');
       
                fprintf(fid,'Rexp1  = Rd(+1); % 50 - 10Year Yields expectations\n');    
                fprintf(fid,'Rexp2  = Rexp1(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp3  = Rexp2(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp4  = Rexp3(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp5  = Rexp4(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp6  = Rexp5(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp7  = Rexp6(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp8  = Rexp7(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp9  = Rexp8(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp10  = Rexp9(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp11  = Rexp10(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp12  = Rexp11(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp13  = Rexp12(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp14  = Rexp13(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp15  = Rexp14(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp16  = Rexp15(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp17  = Rexp16(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp18  = Rexp17(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp19  = Rexp18(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp20  = Rexp19(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp21  = Rexp20(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp22  = Rexp21(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp23  = Rexp22(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp24  = Rexp23(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp25  = Rexp24(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp26  = Rexp25(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp27  = Rexp26(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp28  = Rexp27(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp29  = Rexp28(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp30  = Rexp29(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp31  = Rexp30(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp32  = Rexp31(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp33  = Rexp32(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp34  = Rexp33(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp35  = Rexp34(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp36  = Rexp35(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp37  = Rexp36(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp38  = Rexp37(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp39  = Rexp38(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp40  = Rexp39(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'BVaR = mu/(q*(exp(0.25)-1)); \n');

                
                fprintf(fid,'end;\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 4. Initial values and steady state\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'%resid;\n');
                fprintf(fid,'%steady;  \n');
                fprintf(fid,'%check;                    \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 5. Shock declaration  \n');
                fprintf(fid,'//                       \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'shocks;\n');
                fprintf(fid,'var z_shk = sigmaz^2;\n');
                fprintf(fid,'var mp_shk = sigmamp^2;\n');
                fprintf(fid,'var bk_shk = sigmabk^2;\n');
                fprintf(fid,'var qe_shk = sigmaqe^2;\n');
                fprintf(fid,'end;\n');
                fprintf(fid,'%stoch_simul(order=1,irf = 0,hp_filter = 1600)  Y I q gammag bigA TL bigN Rd infl mu alpha;\n');
                fprintf(fid,'%options_.debug = 1;\n');
                fprintf(fid,'%options_.pruning=1;\n');
                fprintf(fid,'%stoch_simul(order=2,replic = 50,irf = 40,noprint,nograph,hp_filter = 1600);\n');
    
fclose('all');   


%% Opening the model with binding ZLB but no QE 
fid = fopen(['noqeFMzlb.mod'],'w+');
%% Writing the mod file for simulation
    
                fprintf(fid,'// A Dynare version of Counter cyclical Monetary policy at the ZLB based on \n');
                fprintf(fid,'// Meh and Moran. 2010. "The Role of Bank Capital in the Propagation of Shocks"\n');
                fprintf(fid,'// JEDC 34: 555-576\n');
                fprintf(fid,'// Written by Matyas Farkas, 2019\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 1. Variable declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'var \n');
                fprintf(fid,'ch    % 1- household consumption\n');
                fprintf(fid,'Ce    % 2- entrepreneurial consumption\n');
                fprintf(fid,'Cb    % 3- banking consumption\n');
                fprintf(fid,'H     % 4- aggregate (composite) labour input\n');
                fprintf(fid,'Y     % 5- Output\n');
                fprintf(fid,'I     % 6- Investment \n');
                fprintf(fid,'bigN  % 7- entrepreneurial net worth \n');
                fprintf(fid,'bigA  % 8- net worth of banking sector (bank capital)\n');
                fprintf(fid,'smallb % 9 - private benefit\n');
                fprintf(fid,'q     % 10- relative price of capital goods\n');
                fprintf(fid,'rk    % 11- rental rate on capital\n');
                fprintf(fid,'infl  % 12 - gross rate of quarterly inflation\n');
                fprintf(fid,'w_h   % 13 - wage rate (households)\n');
                fprintf(fid,'w_e   % 14 - wage rate (entrepreneurs)\n');
                fprintf(fid,'w_b   % 15 - wage rate (bankers)\n');
                fprintf(fid,'Rd    % 16 - gross, nominal rate of interest\n');
                fprintf(fid,'Ra    % 17 - gross return on bank capital\n');
                fprintf(fid,'lam   % 18 - marginal utility of consumption\n');
                fprintf(fid,'mu     % 19 - endogenous monitoring intensity\n');
                fprintf(fid,'p     % 20 - inverse of real money balances\n');
                fprintf(fid,'TL    % 21 -Aggregate bank lending in the economy\n');
                fprintf(fid,'mc    % 22 - fraction of HH''s financiel assets held as currency\n');
                fprintf(fid,'s     % 23 -marginal costs\n');
                fprintf(fid,'mgrowth % 24- growth rate of money\n');
                fprintf(fid,'expinfl % 25 - expected rate of inflation at time t+1\n');
                fprintf(fid,'smalld  % 26 - real value of household deposits  \n');
                fprintf(fid,'gY   % 27- gross rate of output growth\n');
                fprintf(fid,'totC % 28 - aggregate consumption\n');
                fprintf(fid,'u    % 29 - utilization rate on physical capital \n');
                fprintf(fid,'keff  % 30 - effective capital services\n');
                fprintf(fid,'K     % 31 - total physical capital\n');
                fprintf(fid,'Kb    % 32 - holdings of physical capital by banking sector\n');
                fprintf(fid,'Ke    % 33 - holdings of physical capital by entrepreneurial sector\n');
                fprintf(fid,'ptilde % 34 - price chosen by reoptimising price-setters\n');
                fprintf(fid,'nump   % 35 - auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'denp   % 36 -auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'wtilde % 37 -price chosen by reoptimising wage-setters\n');
                fprintf(fid,'numw   % 38 - auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'denw   % 39 -auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'lz     % 40 - log of exogenous technology z\n');
                fprintf(fid,'lmp    % 41- log of monetary policy disturbance\n');
                fprintf(fid,'lbk    % 42 - log of disturbances to bank capital\n');
                fprintf(fid,'log_y  % 43 - auxiliary variable for log output\n');
                fprintf(fid,'log_I  % 44 -  auxiliary variable for log of investment\n');
                fprintf(fid,'gammag % 45 - leverage ratio set by the supervisory authority \n');
                fprintf(fid,'alpha  % 46 - endogenous probability of default\n');
                fprintf(fid,'rnot   % 47 - shadow policy rate\n');
                fprintf(fid,'CBBS % 48 - QE in percentag of output\n');
                fprintf(fid,'lqe  % 49 - log of QE disturbance\n');
                fprintf(fid,'inflexp1  % 50 - 10Year inflation expectations\n');

                fprintf(fid,'inflexp2  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  % 50 - 10Year inflation expectations\n');    
                
                fprintf(fid,'Rexp1  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp2  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp3  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp4  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp5  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp6  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp7  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp8  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp9  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp10  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp11  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp12  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp13  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp14  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp15  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp16  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp17  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp18  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp19  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp20  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp21  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp22  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp23  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp24  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp25  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp26  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp27  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp28  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp29  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp30  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp31  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp32  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp33  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp34  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp35  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp36  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp37  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp38  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp39  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp40  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'BVaR % Bank VaR driven default probability \n');


                fprintf(fid,';\n');
                fprintf(fid,'varexo \n');
                fprintf(fid,'z_shk  % innovation to productivity process\n');
                fprintf(fid,'mp_shk % innovation to monetary policy process\n');
                fprintf(fid,'bk_shk % innovation to the bank capital shock\n');
                fprintf(fid,'qe_shk % innovation to QE\n');
                fprintf(fid,';\n');
%% Parameter definition 
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 2. Parameter declaration and calibration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'parameters \n');
                fprintf(fid,'habit  % Parameter of habit formation\n');
                fprintf(fid,'bet      % Discount factor\n');
                fprintf(fid,'delta   % Depreciation of physical capital\n');
                fprintf(fid,'reta     % Parameter of leisure in utility\n');
                fprintf(fid,'psi_l  % Parameter related to labour supply (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) \n');
                fprintf(fid,'elas_l % Elasticity of labour utility psi_l = 4.55 and elas_l=0.429  \n');
                fprintf(fid,'chi1 % Parameter governing capital utilization following Fernandez Villaverde et al. (2010) upsilon(u) = chi_1(u-1)+ 0.5*chi_2(u-1)^2\n');
                fprintf(fid,'chi2  % Parameter in capital utilization\n');
                fprintf(fid,'pi_ss % Steady state level of inflation\n');
                fprintf(fid,'xi_w %Parameter governing nominal rigidities and elasticities of substitution following CEE, 2005 xi_w = 21\n');
                fprintf(fid,'phi_w % Parameter governing nominal rigidities of wage setting\n');
                fprintf(fid,'mark_w % Parameter of wage markup\n');
                fprintf(fid,'eta_h % Measure of agents that are households\n');
                fprintf(fid,'eta_e % Measure of agents that are entrepreneurs\n');
                fprintf(fid,'eta_b % Measure of agents that are bankers\n');
                fprintf(fid,'xi_p % Parameter governing nominal rigidities of the intermediate producers\n');
                fprintf(fid,'phi_p % Parameter of price updating probability of intermediate producers\n');
                fprintf(fid,'mark_p % Price markup on the intermediate producers side\n');
                fprintf(fid,'theta_k % Share of capital in production\n');
                fprintf(fid,'theta_h % Share of household labor in production\n');
                fprintf(fid,'theta_e % Share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b % Share of bank labor in production\n');
                fprintf(fid,'bigR % Overall return to the investment project \n');
                fprintf(fid,'delalpha % Difference in probability of success between high and low effort\n');
                fprintf(fid,'tau_b % Survival probability of banker\n');
                fprintf(fid,'tau_e % Survival probability of entrepreneurs\n');
                fprintf(fid,'lam_r  % AR(1) parameter in the Taylor rule, for short term interest rate smoothing\n');
                fprintf(fid,'lam_pi % Parameter on the inflation target in the Taylor rule\n');
                fprintf(fid,'lam_y % Parameter of output stabilization in the Taylor rule\n');
                fprintf(fid,'bigtheta % Overall Profits\n');
                fprintf(fid,'bby % Additional capital endowment banks receive every period, as a percentage of output, set 0 by default, increased to 0.007 for the experiment Economy with More Bank Capital\n');
                fprintf(fid,'nu % Valuation mulitplier for exiting bankers consumption\n');
                fprintf(fid,'rhoz % AR(1) coefficient for the technology shock\n');
                fprintf(fid,'rhomp % AR(1) coefficient for the monetary policy\n');
                fprintf(fid,'rhobk % AR(1) coefficient of the bank capital shock\n');
                fprintf(fid,'sigmaz % Standard deviation of the technology shock\n');
                fprintf(fid,'sigmamp % Standard deviation of the monetary policy shock\n');
                fprintf(fid,'sigmabk  % Standard deviation of the bank capital shock\n');
                fprintf(fid,'alpha_ss % Steady state probability of success given high effort that is also the bank success probability\n');
                fprintf(fid,'mu_ss % Steady state of monitoring effort by banks\n');
                fprintf(fid,'% gammag_ss % Steady state level of bank leverage \n');
                fprintf(fid,'omega % Parameter linking endogenous probability of success to credit to GDP ratio\n');
                fprintf(fid,'varsigma % Parameter linking endogenous riskiness of the banking sector to total lending\n');
                fprintf(fid,'epsb % Parameter linking probability of success to monitoring\n');
                fprintf(fid,'Btopbar % Maximum level of private benefit\n');
                fprintf(fid,'Blowbar % Lower level of private benefit\n');
                fprintf(fid,'Chi % Parameter for endogenous private benefit\n');
                fprintf(fid,'CBBSp % Parameter governing the QE/Central bank balance sheet reaction\n');
                fprintf(fid,'sigmaqe % Standard deviation of QE shock\n');
                fprintf(fid,'rhoqe % AR(1) coefficient of the QE shock process\n');
                fprintf(fid,';\n');
                
%% Calibration
                fprintf(fid,'sigmaqe = %15.14f; \n',sigmaqe);
                fprintf(fid,'rhoqe = %5.4f; \n',rhoqe);
                fprintf(fid,'habit = %5.4f;  %parameter governing habit formation (CEE 2005 use 0.65)\n', habit);
                fprintf(fid,'bet = %5.4f;    %discount factor\n', bet);
                fprintf(fid,'delta = %5.4f;  %depreciation of physical capital\n', delta);
                fprintf(fid,'reta = %15.14f;\n',reta);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% parameters related to labour supply\n');
                fprintf(fid,'% (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) )\n');
                fprintf(fid,'% elas_l = 1 follows CEE(2005)\n');
                fprintf(fid,'% elas_l = 0.429 reproduces (for dynamics) our JEDC specification with log disutility\n');
                fprintf(fid,'% in either case, psi_l is set in order for work effort at ss to be 0.3\n');
                fprintf(fid,'% (this requires psi_l = 4.55 if elas_l = 0.429)\n');
                fprintf(fid,'%psi_l = 9.05;\n');
                fprintf(fid,'%elas_l = 1.0;\n');
                fprintf(fid,'psi_l = %5.4f;\n', psi_l);
                fprintf(fid,'elas_l = %5.4f;\n', elas_l);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'%parameters of monetary policy\n');
                fprintf(fid,'pi_ss = %8.7f;\n', pi_ss);
                fprintf(fid,'lam_r = %5.4f;\n', lam_r);
                fprintf(fid,'lam_pi = %5.4f;\n', lam_pi);
                fprintf(fid,'lam_y = %5.4f;\n', lam_y);
                fprintf(fid,'%lam_y = 0.1;\n');
                fprintf(fid,'Rd_temp = pi_ss/bet;\n');
                fprintf(fid,'% nominal rigidities and elasticities of substitution\n');
                fprintf(fid,'% (follows CEE, 2005)\n');
                fprintf(fid,'xi_w = %3.1f;\n', xi_w);
                fprintf(fid,'phi_w = %5.4f;\n', phi_w);
                fprintf(fid,'xi_p = %5.4f;\n',xi_p);
                fprintf(fid,'phi_p = %5.4f;\n',phi_p);
                fprintf(fid,'mark_p  = xi_p/(xi_p-1);\n');
                fprintf(fid,'mark_w = xi_w/(xi_w-1);\n');
                fprintf(fid,'eta_h = %5.4f;            % measure of agents that are households\n', eta_h);
                fprintf(fid,'eta_e = %5.4f;           % measure of agents that are entrepreneurs\n', eta_e);
                fprintf(fid,'eta_b = 1-eta_h-eta_e;    % measure of agents that are bankers\n');
                fprintf(fid,'theta_h = %15.14f;   % share of household labor in production\n', theta_h);
                fprintf(fid,'theta_k = %15.14f;       % share of capital in production\n', theta_k);
                fprintf(fid,'theta_e = (1.0-theta_h-theta_k)/2.0;    % share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b = 1.0-theta_h-theta_k-theta_e;   % share of bank labor in production\n');
                fprintf(fid,'% sector producing physical capital\n');
                fprintf(fid,'delalpha = %15.14f;\n',delalpha);
                fprintf(fid,'tau_b = %15.14f; \n',tau_b);
                fprintf(fid,'tau_e = %15.14f;\n', tau_e);
                fprintf(fid,'bigR = %15.14f; \n', bigR);
                fprintf(fid,'% In some experiments, we want to leave mu_ss unchanged at 0.025 (to compute s.s.)\n');
                fprintf(fid,'% but have mu = 0.0 for the linearization (to produce "WITH BANK CAPITAl CHANNEL" responses\n');
                fprintf(fid,'% and "NO BANK CAPITAl CHANNEL" responses)\n');
                fprintf(fid,'% in order to do that, need to disable lines 81-84 in the "steady_.m" program\n');
                fprintf(fid,'% of your dynare build\n');
                fprintf(fid,'\n');
                fprintf(fid,'bby = %5.4f;\n', bby);
                fprintf(fid,'               % additional capital endowment banks receive every period, as a percentage of output.\n');
                fprintf(fid,'               % (This is used for the experiments titled\n');
                fprintf(fid,'               % "Economy with More Bank Capital"): for that, set bby to  0.007\n');
                fprintf(fid,'nu = %15.14f;\n',nu);
                fprintf(fid,'% Parameters related to shock processes\n');
                fprintf(fid,'rhoz = %15.14f;    %autocorrelation of technology\n',rhoz);
                fprintf(fid,'sigmaz = %15.14f; % s.d. of innovation to technology\n',sigmaz);
                fprintf(fid,'%sigmaz = 0.0015;\n');
                fprintf(fid,'%Parameter related to capital utilisation:\n');
                fprintf(fid,'sigma_a = %15.14f;\n',sigma_a);
                fprintf(fid,'rhomp = %15.14f;  %autocorrelation of disturbances to the MP rule\n',rhomp);
                fprintf(fid,'sigmamp = %15.14f; % s.d. of innovations to these disturbances.\n',sigmamp);
                fprintf(fid,'rhobk = %15.14f;  %autocorrelation of shocks to bank capital\n',rhobk);
                fprintf(fid,'sigmabk = %15.14f; % s.d. of innovations to these disturbances.\n',rhobk);
                fprintf(fid,'%sigmabk = 0.000001;\n');
                fprintf(fid,'alpha_ss = %15.14f;\n',alpha_ss);
                fprintf(fid,'Chi =  %15.13f;            % 3.0792;       %sensitivity of entrepreneurial private benefit to monitoring intensity\n',Chi);
                fprintf(fid,'epsb = %15.13f;      %linkage between shirking and premium paid\n', epsb);
                fprintf(fid,'Btopbar =  %15.13f; %maximum private benefits from shirking;\n', Btopbar);
                fprintf(fid,'Blowbar = %5.4f; \n',Blowbar);
                fprintf(fid,'omega = %15.14f;     % Strength of response of monetary authority to deviations from credittogdp \n', omega);
                fprintf(fid,'varsigma = %15.14f;  % Strength of the endogenous link between credit to GDP devation from SS to banking sector riskiness\n', varsigma);
                fprintf(fid,'mu_ss = %15.14f;\n',mu_ss);
                fprintf(fid,'CBBSp = %15.14f;\n',CBBSp);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');               
%% Steady state computations
                fprintf(fid,'% steady-state computations:\n');
                fprintf(fid,'\n');
                fprintf(fid,'alphatemp = alpha_ss;\n');
                fprintf(fid,'mutemp = mu_ss;\n');
                fprintf(fid,'smallbtemp = Btopbar*(1+Chi*mutemp)^(-epsb);\n');
                fprintf(fid,'kk1 = delta*theta_k/(alphatemp*bigR*(1/bet-1+delta)); \n');
                fprintf(fid,'betatemp  = 1/bet;\n');
                fprintf(fid,'infl_temp = pi_ss;\n');
                fprintf(fid,'qtemp = kk1*(alphatemp*tau_b*mutemp*betatemp/delalpha-(1+mutemp+alphatemp*mutemp/(Rd_temp*delalpha)));\n');
                fprintf(fid,'qtemp = qtemp/(alphatemp*smallbtemp*kk1/(Rd_temp*delalpha)-alphatemp*bigR*kk1/Rd_temp-theta_e-theta_b-bby-alphatemp*tau_e*smallbtemp*kk1*betatemp/delalpha);\n');
                fprintf(fid,'Gtemp = 1+mutemp-(qtemp*alphatemp/Rd_temp)*(bigR-mutemp/(qtemp*delalpha)-smallbtemp/delalpha);\n');
                fprintf(fid,'IY = kk1/qtemp;\n');
                fprintf(fid,'KY = alphatemp*bigR*IY/delta; \n');
                fprintf(fid,'KeY = tau_e*alphatemp*smallbtemp*IY/delalpha;\n');
                fprintf(fid,'KbY = tau_b*alphatemp*mutemp*IY/(qtemp*delalpha);\n');
                fprintf(fid,'KhY = KY - KeY - KbY;\n');
                fprintf(fid,'CeY = (1-tau_e)*alphatemp*smallbtemp*IY*qtemp/delalpha;\n');
                fprintf(fid,'CbY = nu*(1-tau_b)*alphatemp*mutemp*IY/delalpha;\n');
                fprintf(fid,'ChY = 1 + bby - CeY - CbY  - (1+mutemp)*IY;\n');
                fprintf(fid,'essai = (1-bet*habit)*theta_h/((1-habit)*ChY*psi_l*mark_w);\n');
                fprintf(fid,'smallh = essai^(1/(1+elas_l));\n');
                fprintf(fid,'Htemp = smallh*eta_h^(xi_w/(xi_w-1));\n');
                fprintf(fid,'kk2 = (KY^(1/(1-theta_k))) * (eta_e^(theta_e/(1-theta_k)))* (eta_b^(theta_b/(1-theta_k)))* mark_p^(1/(theta_k-1));\n');
                fprintf(fid,'Ktemp = Htemp^(theta_h/(1-theta_k))* kk2;\n');
                fprintf(fid,'Ytemp = (1/mark_p)* (Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'% fixed cost parameter to ensure zero profits in s.s.\n');
                fprintf(fid,'bigtheta = (mark_p-1)*Ytemp;\n');
                fprintf(fid,'Itemp = IY*Ytemp;\n');
                fprintf(fid,'rktemp = (1/mark_p)*theta_k*(Ktemp^(theta_k-1))*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% Following Fernandez Villaverde et al. (2010) as well as others,\n');
                fprintf(fid,'% set utilisation of capital as \n');
                fprintf(fid,'%upsilon(u) = chi_1 (u - 1) + 0.5chi_2 (u - 1)^2\n');
                fprintf(fid,'%Set parameters in a way that replicates CEE (2005)\n');
                fprintf(fid,'\n');
                fprintf(fid,'chi1 = rktemp;\n');
                fprintf(fid,'chi2 = sigma_a*chi1;  \n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'w_htemp = (1/mark_p)*theta_h*(Ktemp^theta_k)*(Htemp^(theta_h-1))*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'w_etemp = (1/mark_p)*theta_e*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^(theta_e-1))*(eta_b^theta_b);\n');
                fprintf(fid,'w_btemp = (1/mark_p)*theta_b*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^(theta_b-1));\n');
                fprintf(fid,'Ketemp = KeY*Ytemp;\n');
                fprintf(fid,'Kbtemp = KbY*Ytemp;\n');
                fprintf(fid,'Khtemp = KhY*Ytemp;\n');
                fprintf(fid,'Cetemp = CeY*Ytemp;\n');
                fprintf(fid,'Cbtemp = CbY*Ytemp;\n');
                fprintf(fid,'chtemp = ChY*Ytemp/eta_h;\n');
                fprintf(fid,'bigAtemp = eta_b*w_btemp+(rktemp+qtemp*(1-delta))*Kbtemp+bby*Ytemp;\n');
                fprintf(fid,'bigNtemp = eta_e*w_etemp+(rktemp+qtemp*(1-delta))*Ketemp;\n');
                fprintf(fid,'totCtemp = Cetemp+Cbtemp+eta_h*chtemp;\n');
                fprintf(fid,'lamtemp = (1-bet*habit)/((1-habit)*(chtemp));\n');
                fprintf(fid,'smalldtemp = alphatemp*qtemp*( bigR - smallbtemp/delalpha - mutemp/(qtemp*delalpha))*Itemp/(Rd_temp*eta_b);\n');
                fprintf(fid,'ptemp = (Rd_temp-1)*lamtemp/ ( (Rd_temp-1)*lamtemp*eta_b*smalldtemp + eta_h*reta);\n');
                fprintf(fid,'mctemp = reta*ptemp/((Rd_temp-1)*lamtemp);\n');
                fprintf(fid,'Ratemp = alphatemp*qtemp*(mutemp/(qtemp*delalpha))*Itemp/bigAtemp;\n');
                fprintf(fid,'TLtemp = Itemp-bigNtemp;\n');
                fprintf(fid,'wtildetemp = w_htemp*infl_temp*eta_h^(-1/(1-xi_w));\n');
                fprintf(fid,'numwtemp =  ( ( (w_htemp*infl_temp)^(xi_w*(1+elas_l)) * Htemp^(1+elas_l) )/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denwtemp = ( (w_htemp^(xi_w)*infl_temp^(xi_w-1)*Htemp*lamtemp)/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'wtildetemp = (mark_w*psi_l)^(1/(1+xi_w*elas_l))*numwtemp/denwtemp;\n');
                fprintf(fid,'stemp = 1/mark_p;\n');
                fprintf(fid,'mgrowthtemp = infl_temp;\n');
                fprintf(fid,'expinfltemp = infl_temp;\n');
                fprintf(fid,'gYtemp = 1;\n');
                fprintf(fid,'utemp = 1;\n');
                fprintf(fid,'gammagtemp = (Itemp-bigNtemp )/bigAtemp;\n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 3. Model declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'model;  \n');
                fprintf(fid,'1/(ch - habit*ch(-1)) - bet*habit*1/(ch(+1) - habit*ch) = lam;\n');
                fprintf(fid,'reta/(mc/p) = (Rd-1)*lam;\n');
                fprintf(fid,'rk = chi1 + chi2*(u - 1);\n');
                fprintf(fid,'q*lam = bet* (lam(+1)* ( q(+1)*(1-delta) + rk(+1)*u- ( chi1*(u-1)+0.5*chi2*(u(+1)-1)^2 ) ));\n');
                fprintf(fid,'lam = bet*lam(+1)*Rd(+1)/infl(+1);\n');
                fprintf(fid,'infl = p*mgrowth/p(-1);\n');
                fprintf(fid,'wtilde = (xi_w *psi_l/(xi_w-1))^(1/(1+elas_l*xi_w)) * numw /  denw;\n');
                fprintf(fid,'numw =  ( bet*phi_w*(numw(+1)^(1+elas_l*xi_w)) + (H^(1+elas_l)) *(w_h*infl)^(xi_w*(1+elas_l)) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denw =  ( bet*phi_w*(denw(+1)^(1+elas_l*xi_w)) + lam*H*(w_h^xi_w)*(infl^(xi_w-1)) )^(1/(1+elas_l*xi_w)) ;\n');
                fprintf(fid,'infl^(1-xi_w) *w_h^(1-xi_w) = eta_h*(1-phi_w)*wtilde^(1-xi_w) + phi_w* infl(-1)^(1-xi_w) *w_h(-1)^(1-xi_w);\n');
                fprintf(fid,'ptilde = xi_p * nump/ ((xi_p - 1) * denp );\n');
                fprintf(fid,'nump = bet*phi_p*nump(+1) + lam*s*Y*infl^xi_p;\n');
                fprintf(fid,'denp = bet*phi_p*denp(+1) + lam*Y*infl^(xi_p-1);\n');
                fprintf(fid,'infl^(1-xi_p) = (1-phi_p)*ptilde^(1-xi_p) + phi_p*infl(-1)^(1-xi_p);\n');
                fprintf(fid,'rk = s * exp(lz)* theta_k * keff^(theta_k-1) * H^theta_h * eta_e^theta_e *eta_b^(theta_b);\n');
                fprintf(fid,'w_h = s * exp(lz)* theta_h * keff^(theta_k) * H^(theta_h-1) * eta_e^theta_e * eta_b^(theta_b);\n');
                fprintf(fid,'w_e = s * exp(lz)* theta_e * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e-1) * eta_b^(theta_b);\n');
                fprintf(fid,'w_b = s * exp(lz)* theta_b * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e) * eta_b^(theta_b-1);\n');
                fprintf(fid,'%I = (bigA+bigN)/G;\n');
                fprintf(fid,'bigA*Ra = alpha * mu*I/delalpha;\n');
                fprintf(fid,'%G = 1+ mu - q *alpha*( bigR - smallb/delalpha - mu/(q*delalpha) )/(Rd);\n');
                fprintf(fid,'Rd*(1-eta_h*mc)/p = q*alpha*( bigR-smallb/delalpha - mu/(q*delalpha))*I;\n');
                fprintf(fid,'Kb = tau_b*alpha*mu*I/(q*delalpha);\n');
                fprintf(fid,'Ke = tau_e*alpha*smallb*I/delalpha;\n');
                fprintf(fid,'bigA = exp(lbk)*( rk + q*(1-delta))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'%bigA = exp(lbk)*( rk + q*(1-delta*exp(lbk)))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'bigN = ( rk + q*(1-delta))*Ke(-1) + eta_e*w_e;\n');
                fprintf(fid,'Cb = (1-tau_b)*alpha*mu*I/delalpha;\n');
                fprintf(fid,'Ce = (1-tau_e)*alpha*q*smallb*I/delalpha;\n');
                fprintf(fid,'eta_h *ch + Ce + Cb + I + I*mu = Y;\n');
                fprintf(fid,'K = (1-delta)*K(-1) + alpha*bigR*I;\n');
                fprintf(fid,'log(rnot/steady_state(rnot)) = lam_r*log( rnot(-1)/steady_state(rnot) ) + (1-lam_r) * ( lam_pi*log(infl/steady_state(infl)) + lam_y*log(Y/steady_state(Y)) ) + lmp;\n');
                
                %% Attention
                fprintf(fid,'Rd = 1;\n');
               
                %% OK
                fprintf(fid,'Y = exp(lz)* (keff^theta_k)*(H^theta_h)*(eta_e^theta_e)*(eta_b^theta_b) - bigtheta;\n');
                fprintf(fid,'%CA = bigA/((1+mu)*I-bigN);\n');
                fprintf(fid,'eta_b* smalld = (1-eta_h*mc)/p;\n');
                fprintf(fid,'keff = u*( K(-1) - Ke(-1) - Kb(-1) ) + Ke(-1) + Kb(-1);\n');
                fprintf(fid,'expinfl = infl(+1);\n');
                fprintf(fid,'gY = Y/Y(-1);\n');
                fprintf(fid,'TL = I - bigN;\n');
                fprintf(fid,'totC = eta_h *ch + Ce + Cb;\n');
                fprintf(fid,'lz = rhoz*lz(-1)+ z_shk;\n');
                fprintf(fid,'lmp = rhomp*lmp(-1)+ mp_shk;\n');
                fprintf(fid,'lbk = rhobk*lbk(-1)- bk_shk;\n');
                fprintf(fid,'log_y = log(Y);\n');
                fprintf(fid,'log_I = log(I);\n');
                fprintf(fid,'smallb = Btopbar *(1+Chi*mu)^(-epsb);\n');
                fprintf(fid,'alpha = 1 - (1-alpha_ss) - ((I-bigN)/Y-(steady_state(I)-steady_state(bigN))/steady_state(Y))*varsigma ; %Endogenous riskiness of the banking sector\n');
                
                %% Difference
                fprintf(fid,'gammag = steady_state(gammag) + omega*(BVaR-steady_state(BVaR)); % Regulatory authority rule\n');
                
                %% OK
                fprintf(fid,'I =gammag * bigA + bigN + CBBS*Y;  % Equtaion 43 on page 21\n');
                fprintf(fid,'gammag = 1 + (q*Ra/Rd)*(delalpha*bigR-smallb-mu/q)/mu - Ra*delalpha/alpha; % Equation 15 on page 9 in CMM(2011)\n');
                fprintf(fid,'%CBBS = lqe/steady_state(Y);\n');
                fprintf(fid,'%CBBS =  (-0.1)*((I-bigN)/Y-(steady_state(I)-steady_state(bigN))/steady_state(Y)) + lqe/steady_state(Y);\n');
                %% Attention!
               fprintf(fid,'CBBS =  0;\n');
                
                %% OK
                fprintf(fid,'lqe = rhoqe*lqe(-1)+ qe_shk;\n');
                fprintf(fid,'inflexp1  = infl(+1); % 50 - 10Year inflation expectations\n'); 

                fprintf(fid,'inflexp2  = inflexp1(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  = inflexp2(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  = inflexp3(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  = inflexp4(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  = inflexp5(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  = inflexp6(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  = inflexp7(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  = inflexp8(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  = inflexp9(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  = inflexp10(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  = inflexp11(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  = inflexp12(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  = inflexp13(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  = inflexp14(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  = inflexp15(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  = inflexp16(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  = inflexp17(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  = inflexp18(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  = inflexp19(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  = inflexp20(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  = inflexp21(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  = inflexp22(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  = inflexp23(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  = inflexp24(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  = inflexp25(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  = inflexp26(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  = inflexp27(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  = inflexp28(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  = inflexp29(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  = inflexp30(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  = inflexp31(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  = inflexp32(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  = inflexp33(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  = inflexp34(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  = inflexp35(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  = inflexp36(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  = inflexp37(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  = inflexp38(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  = inflexp39(+1); % 50 - 10Year inflation expectations\n');
                
                    fprintf(fid,'Rexp1  = Rd(+1); % 50 - 10Year Yields expectations\n');    
                fprintf(fid,'Rexp2  = Rexp1(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp3  = Rexp2(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp4  = Rexp3(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp5  = Rexp4(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp6  = Rexp5(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp7  = Rexp6(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp8  = Rexp7(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp9  = Rexp8(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp10  = Rexp9(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp11  = Rexp10(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp12  = Rexp11(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp13  = Rexp12(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp14  = Rexp13(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp15  = Rexp14(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp16  = Rexp15(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp17  = Rexp16(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp18  = Rexp17(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp19  = Rexp18(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp20  = Rexp19(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp21  = Rexp20(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp22  = Rexp21(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp23  = Rexp22(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp24  = Rexp23(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp25  = Rexp24(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp26  = Rexp25(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp27  = Rexp26(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp28  = Rexp27(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp29  = Rexp28(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp30  = Rexp29(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp31  = Rexp30(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp32  = Rexp31(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp33  = Rexp32(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp34  = Rexp33(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp35  = Rexp34(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp36  = Rexp35(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp37  = Rexp36(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp38  = Rexp37(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp39  = Rexp38(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp40  = Rexp39(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'BVaR = mu/(q*(exp(0.25)-1)); \n');

                
                fprintf(fid,'end;\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 4. Initial values and steady state\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'%resid;\n');
                fprintf(fid,'%steady;  \n');
                fprintf(fid,'%check;                    \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 5. Shock declaration  \n');
                fprintf(fid,'//                       \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'shocks;\n');
                fprintf(fid,'var z_shk = sigmaz^2;\n');
                fprintf(fid,'var mp_shk = sigmamp^2;\n');
                fprintf(fid,'var bk_shk = sigmabk^2;\n');
                fprintf(fid,'var qe_shk = sigmaqe^2;\n');
                fprintf(fid,'end;\n');
                fprintf(fid,'%stoch_simul(order=1,irf = 0,hp_filter = 1600)  Y I q gammag bigA TL bigN Rd infl mu alpha;\n');
                fprintf(fid,'%options_.debug = 1;\n');
                fprintf(fid,'%options_.pruning=1;\n');
                fprintf(fid,'%stoch_simul(order=2,replic = 50,irf = 40,noprint,nograph,hp_filter = 1600);\n');    
  fclose('all');
  
   fid = fopen(['FMtiv.mod'],'w+');
%% Writing the mod file for simulation
    
                fprintf(fid,'// A Dynare version of Counter cyclical Monetary policy at the ZLB based on \n');
                fprintf(fid,'// Meh and Moran. 2010. "The Role of Bank Capital in the Propagation of Shocks"\n');
                fprintf(fid,'// JEDC 34: 555-576\n');
                fprintf(fid,'// Written by Matyas Farkas, 2019\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 1. Variable declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'var \n');
                fprintf(fid,'ch    % 1- household consumption\n');
                fprintf(fid,'Ce    % 2- entrepreneurial consumption\n');
                fprintf(fid,'Cb    % 3- banking consumption\n');
                fprintf(fid,'H     % 4- aggregate (composite) labour input\n');
                fprintf(fid,'Y     % 5- Output\n');
                fprintf(fid,'I     % 6- Investment \n');
                fprintf(fid,'bigN  % 7- entrepreneurial net worth \n');
                fprintf(fid,'bigA  % 8- net worth of banking sector (bank capital)\n');
                fprintf(fid,'smallb % 9 - private benefit\n');
                fprintf(fid,'q     % 10- relative price of capital goods\n');
                fprintf(fid,'rk    % 11- rental rate on capital\n');
                fprintf(fid,'infl  % 12 - gross rate of quarterly inflation\n');
                fprintf(fid,'w_h   % 13 - wage rate (households)\n');
                fprintf(fid,'w_e   % 14 - wage rate (entrepreneurs)\n');
                fprintf(fid,'w_b   % 15 - wage rate (bankers)\n');
                fprintf(fid,'Rd    % 16 - gross, nominal rate of interest\n');
                fprintf(fid,'Ra    % 17 - gross return on bank capital\n');
                fprintf(fid,'lam   % 18 - marginal utility of consumption\n');
                fprintf(fid,'mu     % 19 - endogenous monitoring intensity\n');
                fprintf(fid,'p     % 20 - inverse of real money balances\n');
                fprintf(fid,'TL    % 21 -Aggregate bank lending in the economy\n');
                fprintf(fid,'mc    % 22 - fraction of HH''s financiel assets held as currency\n');
                fprintf(fid,'s     % 23 -marginal costs\n');
                fprintf(fid,'mgrowth % 24- growth rate of money\n');
                fprintf(fid,'expinfl % 25 - expected rate of inflation at time t+1\n');
                fprintf(fid,'smalld  % 26 - real value of household deposits  \n');
                fprintf(fid,'gY   % 27- gross rate of output growth\n');
                fprintf(fid,'totC % 28 - aggregate consumption\n');
                fprintf(fid,'u    % 29 - utilization rate on physical capital \n');
                fprintf(fid,'keff  % 30 - effective capital services\n');
                fprintf(fid,'K     % 31 - total physical capital\n');
                fprintf(fid,'Kb    % 32 - holdings of physical capital by banking sector\n');
                fprintf(fid,'Ke    % 33 - holdings of physical capital by entrepreneurial sector\n');
                fprintf(fid,'ptilde % 34 - price chosen by reoptimising price-setters\n');
                fprintf(fid,'nump   % 35 - auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'denp   % 36 -auxiliary variable used in solving for ptilde\n');
                fprintf(fid,'wtilde % 37 -price chosen by reoptimising wage-setters\n');
                fprintf(fid,'numw   % 38 - auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'denw   % 39 -auxiliary variable used to help solve for wtilde\n');
                fprintf(fid,'lz     % 40 - log of exogenous technology z\n');
                fprintf(fid,'lmp    % 41- log of monetary policy disturbance\n');
                fprintf(fid,'lbk    % 42 - log of disturbances to bank capital\n');
                fprintf(fid,'log_y  % 43 - auxiliary variable for log output\n');
                fprintf(fid,'log_I  % 44 -  auxiliary variable for log of investment\n');
                fprintf(fid,'gammag % 45 - leverage ratio set by the supervisory authority \n');
                fprintf(fid,'alpha  % 46 - endogenous probability of default\n');
                fprintf(fid,'rnot   % 47 - shadow policy rate\n');
                fprintf(fid,'CBBS % 48 - QE in percentag of output\n');
                fprintf(fid,'lqe  % 49 - log of QE disturbance\n');
                fprintf(fid,'inflexp1  % 50 - 10Year inflation expectations\n');
                
                fprintf(fid,'inflexp2  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  % 50 - 10Year inflation expectations\n');

                fprintf(fid,'Rexp1  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp2  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp3  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp4  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp5  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp6  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp7  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp8  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp9  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp10  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp11  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp12  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp13  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp14  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp15  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp16  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp17  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp18  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp19  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp20  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp21  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp22  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp23  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp24  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp25  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp26  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp27  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp28  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp29  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp30  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp31  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp32  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp33  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp34  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp35  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp36  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp37  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp38  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp39  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'Rexp40  % 50 - 10Year yieds expectations\n');
                fprintf(fid,'BVaR  % Bank VaR driven default probability\n');

                
                fprintf(fid,';\n');
                fprintf(fid,'varexo \n');
                fprintf(fid,'z_shk  % innovation to productivity process\n');
                fprintf(fid,'mp_shk % innovation to monetary policy process\n');
                fprintf(fid,'bk_shk % innovation to the bank capital shock\n');
                fprintf(fid,'qe_shk % innovation to QE\n');
                fprintf(fid,';\n');
%% Parameter definition 
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 2. Parameter declaration and calibration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'parameters \n');
                fprintf(fid,'habit  % Parameter of habit formation\n');
                fprintf(fid,'bet      % Discount factor\n');
                fprintf(fid,'delta   % Depreciation of physical capital\n');
                fprintf(fid,'reta     % Parameter of leisure in utility\n');
                fprintf(fid,'psi_l  % Parameter related to labour supply (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) \n');
                fprintf(fid,'elas_l % Elasticity of labour utility psi_l = 4.55 and elas_l=0.429  \n');
                fprintf(fid,'chi1 % Parameter governing capital utilization following Fernandez Villaverde et al. (2010) upsilon(u) = chi_1(u-1)+ 0.5*chi_2(u-1)^2\n');
                fprintf(fid,'chi2  % Parameter in capital utilization\n');
                fprintf(fid,'pi_ss % Steady state level of inflation\n');
                fprintf(fid,'xi_w %Parameter governing nominal rigidities and elasticities of substitution following CEE, 2005 xi_w = 21\n');
                fprintf(fid,'phi_w % Parameter governing nominal rigidities of wage setting\n');
                fprintf(fid,'mark_w % Parameter of wage markup\n');
                fprintf(fid,'eta_h % Measure of agents that are households\n');
                fprintf(fid,'eta_e % Measure of agents that are entrepreneurs\n');
                fprintf(fid,'eta_b % Measure of agents that are bankers\n');
                fprintf(fid,'xi_p % Parameter governing nominal rigidities of the intermediate producers\n');
                fprintf(fid,'phi_p % Parameter of price updating probability of intermediate producers\n');
                fprintf(fid,'mark_p % Price markup on the intermediate producers side\n');
                fprintf(fid,'theta_k % Share of capital in production\n');
                fprintf(fid,'theta_h % Share of household labor in production\n');
                fprintf(fid,'theta_e % Share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b % Share of bank labor in production\n');
                fprintf(fid,'bigR % Overall return to the investment project \n');
                fprintf(fid,'delalpha % Difference in probability of success between high and low effort\n');
                fprintf(fid,'tau_b % Survival probability of banker\n');
                fprintf(fid,'tau_e % Survival probability of entrepreneurs\n');
                fprintf(fid,'lam_r  % AR(1) parameter in the Taylor rule, for short term interest rate smoothing\n');
                fprintf(fid,'lam_pi % Parameter on the inflation target in the Taylor rule\n');
                fprintf(fid,'lam_y % Parameter of output stabilization in the Taylor rule\n');
                fprintf(fid,'bigtheta % Overall Profits\n');
                fprintf(fid,'bby % Additional capital endowment banks receive every period, as a percentage of output, set 0 by default, increased to 0.007 for the experiment Economy with More Bank Capital\n');
                fprintf(fid,'nu % Valuation mulitplier for exiting bankers consumption\n');
                fprintf(fid,'rhoz % AR(1) coefficient for the technology shock\n');
                fprintf(fid,'rhomp % AR(1) coefficient for the monetary policy\n');
                fprintf(fid,'rhobk % AR(1) coefficient of the bank capital shock\n');
                fprintf(fid,'sigmaz % Standard deviation of the technology shock\n');
                fprintf(fid,'sigmamp % Standard deviation of the monetary policy shock\n');
                fprintf(fid,'sigmabk  % Standard deviation of the bank capital shock\n');
                fprintf(fid,'alpha_ss % Steady state probability of success given high effort that is also the bank success probability\n');
                fprintf(fid,'mu_ss % Steady state of monitoring effort by banks\n');
                fprintf(fid,'% gammag_ss % Steady state level of bank leverage \n');
                fprintf(fid,'omega % Parameter linking endogenous probability of success to credit to GDP ratio\n');
                fprintf(fid,'varsigma % Parameter linking endogenous riskiness of the banking sector to total lending\n');
                fprintf(fid,'epsb % Parameter linking probability of success to monitoring\n');
                fprintf(fid,'Btopbar % Maximum level of private benefit\n');
                fprintf(fid,'Blowbar % Lower level of private benefit\n');
                fprintf(fid,'Chi % Parameter for endogenous private benefit\n');
                fprintf(fid,'CBBSp % Parameter governing the QE/Central bank balance sheet reaction\n');
                fprintf(fid,'sigmaqe % Standard deviation of QE shock\n');
                fprintf(fid,'rhoqe % AR(1) coefficient of the QE shock process\n');
                fprintf(fid,';\n');
                
%% Calibration
                fprintf(fid,'sigmaqe = %15.14f; \n',sigmaqe);
                fprintf(fid,'rhoqe = %5.4f; \n',rhoqe);
                fprintf(fid,'habit = %5.4f;  %parameter governing habit formation (CEE 2005 use 0.65)\n', habit);
                fprintf(fid,'bet = %5.4f;    %discount factor\n', bet);
                fprintf(fid,'delta = %5.4f;  %depreciation of physical capital\n', delta);
                fprintf(fid,'reta = %15.14f;\n',reta);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% parameters related to labour supply\n');
                fprintf(fid,'% (labour disutility is: -psi_l * l^(1+elas_l)  / (1+elas_l) )\n');
                fprintf(fid,'% elas_l = 1 follows CEE(2005)\n');
                fprintf(fid,'% elas_l = 0.429 reproduces (for dynamics) our JEDC specification with log disutility\n');
                fprintf(fid,'% in either case, psi_l is set in order for work effort at ss to be 0.3\n');
                fprintf(fid,'% (this requires psi_l = 4.55 if elas_l = 0.429)\n');
                fprintf(fid,'%psi_l = 9.05;\n');
                fprintf(fid,'%elas_l = 1.0;\n');
                fprintf(fid,'psi_l = %5.4f;\n', psi_l);
                fprintf(fid,'elas_l = %5.4f;\n', elas_l);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'%parameters of monetary policy\n');
                fprintf(fid,'pi_ss = %8.7f;\n', pi_ss);
                fprintf(fid,'lam_r = %5.4f;\n', lam_r);
                fprintf(fid,'lam_pi = %5.4f;\n', lam_pi);
                fprintf(fid,'lam_y = %5.4f;\n', lam_y);
                fprintf(fid,'%lam_y = 0.1;\n');
                fprintf(fid,'Rd_temp = pi_ss/bet;\n');
                fprintf(fid,'% nominal rigidities and elasticities of substitution\n');
                fprintf(fid,'% (follows CEE, 2005)\n');
                fprintf(fid,'xi_w = %3.1f;\n', xi_w);
                fprintf(fid,'phi_w = %5.4f;\n', phi_w);
                fprintf(fid,'xi_p = %5.4f;\n',xi_p);
                fprintf(fid,'phi_p = %5.4f;\n',phi_p);
                fprintf(fid,'mark_p  = xi_p/(xi_p-1);\n');
                fprintf(fid,'mark_w = xi_w/(xi_w-1);\n');
                fprintf(fid,'eta_h = %5.4f;            % measure of agents that are households\n', eta_h);
                fprintf(fid,'eta_e = %5.4f;           % measure of agents that are entrepreneurs\n', eta_e);
                fprintf(fid,'eta_b = 1-eta_h-eta_e;    % measure of agents that are bankers\n');
                fprintf(fid,'theta_h = %15.14f;   % share of household labor in production\n', theta_h);
                fprintf(fid,'theta_k = %15.14f;       % share of capital in production\n', theta_k);
                fprintf(fid,'theta_e = (1.0-theta_h-theta_k)/2.0;    % share of entrepreneurial labor in production\n');
                fprintf(fid,'theta_b = 1.0-theta_h-theta_k-theta_e;   % share of bank labor in production\n');
                fprintf(fid,'% sector producing physical capital\n');
                fprintf(fid,'delalpha = %15.14f;\n',delalpha);
                fprintf(fid,'tau_b = %15.14f; \n',tau_b);
                fprintf(fid,'tau_e = %15.14f;\n', tau_e);
                fprintf(fid,'bigR = %15.14f; \n', bigR);
                fprintf(fid,'% In some experiments, we want to leave mu_ss unchanged at 0.025 (to compute s.s.)\n');
                fprintf(fid,'% but have mu = 0.0 for the linearization (to produce "WITH BANK CAPITAl CHANNEL" responses\n');
                fprintf(fid,'% and "NO BANK CAPITAl CHANNEL" responses)\n');
                fprintf(fid,'% in order to do that, need to disable lines 81-84 in the "steady_.m" program\n');
                fprintf(fid,'% of your dynare build\n');
                fprintf(fid,'bby = %5.4f;\n', bby);
                fprintf(fid,'               % additional capital endowment banks receive every period, as a percentage of output.\n');
                fprintf(fid,'               % (This is used for the experiments titled\n');
                fprintf(fid,'               % "Economy with More Bank Capital"): for that, set bby to  0.007\n');
                fprintf(fid,'nu = %15.14f;\n',nu);
                fprintf(fid,'% Parameters related to shock processes\n');
                fprintf(fid,'rhoz = %15.14f;    %autocorrelation of technology\n',rhoz);
                fprintf(fid,'sigmaz = %15.14f; % s.d. of innovation to technology\n',sigmaz);
                fprintf(fid,'%sigmaz = 0.0015;\n');
                fprintf(fid,'%Parameter related to capital utilisation:\n');
                fprintf(fid,'sigma_a = %15.14f;\n',sigma_a);
                fprintf(fid,'rhomp = %15.14f;  %autocorrelation of disturbances to the MP rule\n',rhomp);
                fprintf(fid,'sigmamp = %15.14f; % s.d. of innovations to these disturbances.\n',sigmamp);
                fprintf(fid,'rhobk = %15.14f;  %autocorrelation of shocks to bank capital\n',rhobk);
                fprintf(fid,'sigmabk = %15.14f; % s.d. of innovations to these disturbances.\n',rhobk);
                fprintf(fid,'%sigmabk = 0.000001;\n');
                fprintf(fid,'alpha_ss = %15.14f;\n',alpha_ss);
                fprintf(fid,'Chi =  %15.13f;            % 3.0792;       %sensitivity of entrepreneurial private benefit to monitoring intensity\n',Chi);
                fprintf(fid,'epsb = %15.13f;      %linkage between shirking and premium paid\n', epsb);
                fprintf(fid,'Btopbar =  %15.13f; %maximum private benefits from shirking;\n', Btopbar);
                fprintf(fid,'Blowbar = %5.4f; \n',Blowbar);
                fprintf(fid,'omega = %15.14f;     % Strength of response of monetary authority to deviations from credittogdp \n', omega);
                fprintf(fid,'varsigma = %15.14f;  % Strength of the endogenous link between credit to GDP devation from SS to banking sector riskiness\n', varsigma);
                fprintf(fid,'mu_ss = %15.14f;\n',mu_ss);
                fprintf(fid,'CBBSp = %15.14f;\n',CBBSp);
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');               
%% Steady state computations
                fprintf(fid,'% steady-state computations:\n');
                fprintf(fid,'\n');
                fprintf(fid,'alphatemp = alpha_ss;\n');
                fprintf(fid,'mutemp = mu_ss;\n');
                fprintf(fid,'smallbtemp = Btopbar*(1+Chi*mutemp)^(-epsb);\n');
                fprintf(fid,'kk1 = delta*theta_k/(alphatemp*bigR*(1/bet-1+delta)); \n');
                fprintf(fid,'betatemp  = 1/bet;\n');
                fprintf(fid,'infl_temp = pi_ss;\n');
                fprintf(fid,'qtemp = kk1*(alphatemp*tau_b*mutemp*betatemp/delalpha-(1+mutemp+alphatemp*mutemp/(Rd_temp*delalpha)));\n');
                fprintf(fid,'qtemp = qtemp/(alphatemp*smallbtemp*kk1/(Rd_temp*delalpha)-alphatemp*bigR*kk1/Rd_temp-theta_e-theta_b-bby-alphatemp*tau_e*smallbtemp*kk1*betatemp/delalpha);\n');
                fprintf(fid,'Gtemp = 1+mutemp-(qtemp*alphatemp/Rd_temp)*(bigR-mutemp/(qtemp*delalpha)-smallbtemp/delalpha);\n');
                fprintf(fid,'IY = kk1/qtemp;\n');
                fprintf(fid,'KY = alphatemp*bigR*IY/delta; \n');
                fprintf(fid,'KeY = tau_e*alphatemp*smallbtemp*IY/delalpha;\n');
                fprintf(fid,'KbY = tau_b*alphatemp*mutemp*IY/(qtemp*delalpha);\n');
                fprintf(fid,'KhY = KY - KeY - KbY;\n');
                fprintf(fid,'CeY = (1-tau_e)*alphatemp*smallbtemp*IY*qtemp/delalpha;\n');
                fprintf(fid,'CbY = nu*(1-tau_b)*alphatemp*mutemp*IY/delalpha;\n');
                fprintf(fid,'ChY = 1 + bby - CeY - CbY  - (1+mutemp)*IY;\n');
                fprintf(fid,'essai = (1-bet*habit)*theta_h/((1-habit)*ChY*psi_l*mark_w);\n');
                fprintf(fid,'smallh = essai^(1/(1+elas_l));\n');
                fprintf(fid,'Htemp = smallh*eta_h^(xi_w/(xi_w-1));\n');
                fprintf(fid,'kk2 = (KY^(1/(1-theta_k))) * (eta_e^(theta_e/(1-theta_k)))* (eta_b^(theta_b/(1-theta_k)))* mark_p^(1/(theta_k-1));\n');
                fprintf(fid,'Ktemp = Htemp^(theta_h/(1-theta_k))* kk2;\n');
                fprintf(fid,'Ytemp = (1/mark_p)* (Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'% fixed cost parameter to ensure zero profits in s.s.\n');
                fprintf(fid,'bigtheta = (mark_p-1)*Ytemp;\n');
                fprintf(fid,'Itemp = IY*Ytemp;\n');
                fprintf(fid,'rktemp = (1/mark_p)*theta_k*(Ktemp^(theta_k-1))*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'% Following Fernandez Villaverde et al. (2010) as well as others,\n');
                fprintf(fid,'% set utilisation of capital as \n');
                fprintf(fid,'%upsilon(u) = chi_1 (u - 1) + 0.5chi_2 (u - 1)^2\n');
                fprintf(fid,'%Set parameters in a way that replicates CEE (2005)\n');
                fprintf(fid,'\n');
                fprintf(fid,'chi1 = rktemp;\n');
                fprintf(fid,'chi2 = sigma_a*chi1;  \n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'w_htemp = (1/mark_p)*theta_h*(Ktemp^theta_k)*(Htemp^(theta_h-1))*(eta_e^theta_e)*(eta_b^theta_b);\n');
                fprintf(fid,'w_etemp = (1/mark_p)*theta_e*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^(theta_e-1))*(eta_b^theta_b);\n');
                fprintf(fid,'w_btemp = (1/mark_p)*theta_b*(Ktemp^theta_k)*(Htemp^theta_h)*(eta_e^theta_e)*(eta_b^(theta_b-1));\n');
                fprintf(fid,'Ketemp = KeY*Ytemp;\n');
                fprintf(fid,'Kbtemp = KbY*Ytemp;\n');
                fprintf(fid,'Khtemp = KhY*Ytemp;\n');
                fprintf(fid,'Cetemp = CeY*Ytemp;\n');
                fprintf(fid,'Cbtemp = CbY*Ytemp;\n');
                fprintf(fid,'chtemp = ChY*Ytemp/eta_h;\n');
                fprintf(fid,'bigAtemp = eta_b*w_btemp+(rktemp+qtemp*(1-delta))*Kbtemp+bby*Ytemp;\n');
                fprintf(fid,'bigNtemp = eta_e*w_etemp+(rktemp+qtemp*(1-delta))*Ketemp;\n');
                fprintf(fid,'totCtemp = Cetemp+Cbtemp+eta_h*chtemp;\n');
                fprintf(fid,'lamtemp = (1-bet*habit)/((1-habit)*(chtemp));\n');
                fprintf(fid,'smalldtemp = alphatemp*qtemp*( bigR - smallbtemp/delalpha - mutemp/(qtemp*delalpha))*Itemp/(Rd_temp*eta_b);\n');
                fprintf(fid,'ptemp = (Rd_temp-1)*lamtemp/ ( (Rd_temp-1)*lamtemp*eta_b*smalldtemp + eta_h*reta);\n');
                fprintf(fid,'mctemp = reta*ptemp/((Rd_temp-1)*lamtemp);\n');
                fprintf(fid,'Ratemp = alphatemp*qtemp*(mutemp/(qtemp*delalpha))*Itemp/bigAtemp;\n');
                fprintf(fid,'TLtemp = Itemp-bigNtemp;\n');
                fprintf(fid,'wtildetemp = w_htemp*infl_temp*eta_h^(-1/(1-xi_w));\n');
                fprintf(fid,'numwtemp =  ( ( (w_htemp*infl_temp)^(xi_w*(1+elas_l)) * Htemp^(1+elas_l) )/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denwtemp = ( (w_htemp^(xi_w)*infl_temp^(xi_w-1)*Htemp*lamtemp)/(1-bet*phi_w) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'wtildetemp = (mark_w*psi_l)^(1/(1+xi_w*elas_l))*numwtemp/denwtemp;\n');
                fprintf(fid,'stemp = 1/mark_p;\n');
                fprintf(fid,'mgrowthtemp = infl_temp;\n');
                fprintf(fid,'expinfltemp = infl_temp;\n');
                fprintf(fid,'gYtemp = 1;\n');
                fprintf(fid,'utemp = 1;\n');
                fprintf(fid,'gammagtemp = (Itemp-bigNtemp )/bigAtemp;\n');
                fprintf(fid,'%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 3. Model declaration\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'model;  \n');
                fprintf(fid,'1/(ch - habit*ch(-1)) - bet*habit*1/(ch(+1) - habit*ch) = lam;\n');
                fprintf(fid,'reta/(mc/p) = (Rd-1)*lam;\n');
                fprintf(fid,'rk = chi1 + chi2*(u - 1);\n');
                fprintf(fid,'q*lam = bet* (lam(+1)* ( q(+1)*(1-delta) + rk(+1)*u- ( chi1*(u-1)+0.5*chi2*(u(+1)-1)^2 ) ));\n');
                fprintf(fid,'lam = bet*lam(+1)*Rd(+1)/infl(+1);\n');
                fprintf(fid,'infl = p*mgrowth/p(-1);\n');
                fprintf(fid,'wtilde = (xi_w *psi_l/(xi_w-1))^(1/(1+elas_l*xi_w)) * numw /  denw;\n');
                fprintf(fid,'numw =  ( bet*phi_w*(numw(+1)^(1+elas_l*xi_w)) + (H^(1+elas_l)) *(w_h*infl)^(xi_w*(1+elas_l)) )^(1/(1+elas_l*xi_w));\n');
                fprintf(fid,'denw =  ( bet*phi_w*(denw(+1)^(1+elas_l*xi_w)) + lam*H*(w_h^xi_w)*(infl^(xi_w-1)) )^(1/(1+elas_l*xi_w)) ;\n');
                fprintf(fid,'infl^(1-xi_w) *w_h^(1-xi_w) = eta_h*(1-phi_w)*wtilde^(1-xi_w) + phi_w* infl(-1)^(1-xi_w) *w_h(-1)^(1-xi_w);\n');
                fprintf(fid,'ptilde = xi_p * nump/ ((xi_p - 1) * denp );\n');
                fprintf(fid,'nump = bet*phi_p*nump(+1) + lam*s*Y*infl^xi_p;\n');
                fprintf(fid,'denp = bet*phi_p*denp(+1) + lam*Y*infl^(xi_p-1);\n');
                fprintf(fid,'infl^(1-xi_p) = (1-phi_p)*ptilde^(1-xi_p) + phi_p*infl(-1)^(1-xi_p);\n');
                fprintf(fid,'rk = s * exp(lz)* theta_k * keff^(theta_k-1) * H^theta_h * eta_e^theta_e *eta_b^(theta_b);\n');
                fprintf(fid,'w_h = s * exp(lz)* theta_h * keff^(theta_k) * H^(theta_h-1) * eta_e^theta_e * eta_b^(theta_b);\n');
                fprintf(fid,'w_e = s * exp(lz)* theta_e * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e-1) * eta_b^(theta_b);\n');
                fprintf(fid,'w_b = s * exp(lz)* theta_b * keff^(theta_k) * H^(theta_h) * eta_e^(theta_e) * eta_b^(theta_b-1);\n');
                fprintf(fid,'%I = (bigA+bigN)/G;\n');
                fprintf(fid,'bigA*Ra = alpha * mu*I/delalpha;\n');
                fprintf(fid,'%G = 1+ mu - q *alpha*( bigR - smallb/delalpha - mu/(q*delalpha) )/(Rd);\n');
                fprintf(fid,'Rd*(1-eta_h*mc)/p = q*alpha*( bigR-smallb/delalpha - mu/(q*delalpha))*I;\n');
                fprintf(fid,'Kb = tau_b*alpha*mu*I/(q*delalpha);\n');
                fprintf(fid,'Ke = tau_e*alpha*smallb*I/delalpha;\n');
                fprintf(fid,'bigA = exp(lbk)*( rk + q*(1-delta))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'%bigA = exp(lbk)*( rk + q*(1-delta*exp(lbk)))*Kb(-1) + eta_b*w_b;\n');
                fprintf(fid,'bigN = ( rk + q*(1-delta))*Ke(-1) + eta_e*w_e;\n');
                fprintf(fid,'Cb = (1-tau_b)*alpha*mu*I/delalpha;\n');
                fprintf(fid,'Ce = (1-tau_e)*alpha*q*smallb*I/delalpha;\n');
                fprintf(fid,'eta_h *ch + Ce + Cb + I + I*mu = Y;\n');
                fprintf(fid,'K = (1-delta)*K(-1) + alpha*bigR*I;\n');
                fprintf(fid,'log(rnot/steady_state(rnot)) = lam_r*log( rnot(-1)/steady_state(rnot) ) + (1-lam_r) * ( lam_pi*log(infl/steady_state(infl)) + lam_y*log(Y/steady_state(Y)) ) + lmp;\n');
                fprintf(fid,'Rd = rnot;\n');
                fprintf(fid,'Y = exp(lz)* (keff^theta_k)*(H^theta_h)*(eta_e^theta_e)*(eta_b^theta_b) - bigtheta;\n');
                fprintf(fid,'%CA = bigA/((1+mu)*I-bigN);\n');
                fprintf(fid,'eta_b* smalld = (1-eta_h*mc)/p;\n');
                fprintf(fid,'keff = u*( K(-1) - Ke(-1) - Kb(-1) ) + Ke(-1) + Kb(-1);\n');
                fprintf(fid,'expinfl = infl(+1);\n');
                fprintf(fid,'gY = Y/Y(-1);\n');
                fprintf(fid,'TL = I - bigN;\n');
                fprintf(fid,'totC = eta_h *ch + Ce + Cb;\n');
                fprintf(fid,'lz = rhoz*lz(-1)+ z_shk;\n');
                fprintf(fid,'lmp = rhomp*lmp(-1)+ mp_shk;\n');
                fprintf(fid,'lbk = rhobk*lbk(-1)- bk_shk;\n');
                fprintf(fid,'log_y = log(Y);\n');
                fprintf(fid,'log_I = log(I);\n');
                fprintf(fid,'smallb = Btopbar *(1+Chi*mu)^(-epsb);\n');
                fprintf(fid,'alpha = 1 - (1-alpha_ss) - ((I-bigN)/Y-(steady_state(I)-steady_state(bigN))/steady_state(Y))*varsigma ; %Endogenous riskiness of the banking sector\n');
                fprintf(fid,'gammag = steady_state(gammag) + omega*(BVaR-steady_state(BVaR)); % Regulatory authority rule\n');
                fprintf(fid,'I =gammag * bigA + bigN + CBBS*Y;  % Equtaion 43 on page 21\n');
                fprintf(fid,'gammag = 1 + (q*Ra/Rd)*(delalpha*bigR-smallb-mu/q)/mu - Ra*delalpha/alpha; % Equation 15 on page 9 in CMM(2011)\n');
                fprintf(fid,'CBBS = lqe/steady_state(Y);\n');
                fprintf(fid,'lqe = rhoqe*lqe(-1)+ qe_shk;\n');
                fprintf(fid,'inflexp1  = infl(+1); % 50 - 10Year inflation expectations\n');

                fprintf(fid,'inflexp2  = inflexp1(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp3  = inflexp2(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp4  = inflexp3(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp5  = inflexp4(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp6  = inflexp5(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp7  = inflexp6(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp8  = inflexp7(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp9  = inflexp8(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp10  = inflexp9(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp11  = inflexp10(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp12  = inflexp11(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp13  = inflexp12(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp14  = inflexp13(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp15  = inflexp14(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp16  = inflexp15(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp17  = inflexp16(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp18  = inflexp17(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp19  = inflexp18(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp20  = inflexp19(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp21  = inflexp20(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp22  = inflexp21(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp23  = inflexp22(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp24  = inflexp23(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp25  = inflexp24(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp26  = inflexp25(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp27  = inflexp26(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp28  = inflexp27(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp29  = inflexp28(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp30  = inflexp29(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp31  = inflexp30(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp32  = inflexp31(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp33  = inflexp32(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp34  = inflexp33(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp35  = inflexp34(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp36  = inflexp35(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp37  = inflexp36(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp38  = inflexp37(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp39  = inflexp38(+1); % 50 - 10Year inflation expectations\n');
                fprintf(fid,'inflexp40  = inflexp39(+1); % 50 - 10Year inflation expectations\n');

                 fprintf(fid,'Rexp1  = Rd(+1); % 50 - 10Year Yields expectations\n');    
                fprintf(fid,'Rexp2  = Rexp1(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp3  = Rexp2(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp4  = Rexp3(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp5  = Rexp4(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp6  = Rexp5(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp7  = Rexp6(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp8  = Rexp7(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp9  = Rexp8(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp10  = Rexp9(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp11  = Rexp10(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp12  = Rexp11(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp13  = Rexp12(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp14  = Rexp13(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp15  = Rexp14(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp16  = Rexp15(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp17  = Rexp16(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp18  = Rexp17(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp19  = Rexp18(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp20  = Rexp19(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp21  = Rexp20(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp22  = Rexp21(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp23  = Rexp22(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp24  = Rexp23(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp25  = Rexp24(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp26  = Rexp25(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp27  = Rexp26(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp28  = Rexp27(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp29  = Rexp28(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp30  = Rexp29(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp31  = Rexp30(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp32  = Rexp31(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp33  = Rexp32(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp34  = Rexp33(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp35  = Rexp34(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp36  = Rexp35(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp37  = Rexp36(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp38  = Rexp37(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp39  = Rexp38(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'Rexp40  = Rexp39(+1); % 50 - 10Year Yields expectations\n');
                fprintf(fid,'BVaR = mu/(q*(exp(0.25)-1)); \n');

                fprintf(fid,'end;\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 4. Initial values and steady state\n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'resid;\n');
                fprintf(fid,'steady;  \n');
                fprintf(fid,'check;                    \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'// 5. Shock declaration  \n');
                fprintf(fid,'//                       \n');
                fprintf(fid,'//---------------------------------------------------------------------\n');
                fprintf(fid,'shocks;\n');
                fprintf(fid,'var z_shk = sigmaz^2;\n');
                fprintf(fid,'var mp_shk = sigmamp^2;\n');
                fprintf(fid,'var bk_shk = sigmabk^2;\n');
                fprintf(fid,'var qe_shk = sigmaqe^2;\n');
                fprintf(fid,'end;\n');
                fprintf(fid,'stoch_simul(order=2,irf = 0,hp_filter = 1600)  Y I q gammag bigA TL bigN Rd infl mu alpha;\n');
                fprintf(fid,'options_.debug = 1;\n');
                fprintf(fid,'%options_.pruning=1;\n');
                fprintf(fid,'%stoch_simul(order=2,replic = 50,irf = 40,noprint,nograph,hp_filter = 1600);\n');
                
fclose('all');
  